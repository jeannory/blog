<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Jeannory&#39;s blog">
		<link rel="icon" href="https://jeannory.github.io/blog/favicon.ico">
		<title>Keycloak - Jeannory&#39;s blog</title>
		
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/highlight/default.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/theme.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/bootie-docs.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/site.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="https://jeannory.github.io/blog/">Jeannory&#39;s blog</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li ><a href="https://jeannory.github.io/blog/author">Author</a></li>
			
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Categories<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="https://jeannory.github.io/blog/categories/1/spring-security">1/Spring-Security</a></li>
						
							<li><a href="https://jeannory.github.io/blog/categories/2/springboot-tests">2/Springboot-Tests</a></li>
						
							<li><a href="https://jeannory.github.io/blog/categories/3/keycloak">3/Keycloak</a></li>
						
							<li><a href="https://jeannory.github.io/blog/categories/4/gitlab-ci-cd">4/Gitlab-Ci-Cd</a></li>
						
							<li><a href="https://jeannory.github.io/blog/categories/5/jms-websocket">5/Jms-Websocket</a></li>
						
						</ul>
					</li>
				
				</ul>
				
			</div>
		</div>
	</nav>

<div class="container">


<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">Keycloak</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2020-04-23">April 23, 2020</time></span>
				</div>
				<section>
					

<h2 id="introduction">Introduction</h2>

<p><em>MAJ au 16/07/2020</em></p>

<p>Keycloak est serveur d&rsquo;authentification standalone.
Il est reconnu pour la protection qu&rsquo;il propose en termes de cyber sécurité et aussi par les très nombreuses librairies/fonctionnalités qui permettent une utilisation étendue (Java, AngularJs, Typescript, Ldap, etc..). Beaucoup d&rsquo;entreprises lui font confiance et lui délèguent la partie authentification/autorisation.
C&rsquo;est un projet open source codé en java, qui fait preuve d&rsquo;une grande maturité (version 9 à ce jour).</p>

<p>Mohamed Youssfi formateur java explique comment sécuriser des applications en micro-service avec Keycloak à travers 11 vidéos.</p>

<!-- <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/watch?v=2DYWyE9jkEY" style="position: absolute; top: 0; left: 0; width: 50%; height: 75%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div> -->

<h3 id="vidéos-de-m-mohamed-youssfi">Vidéos de M. Mohamed Youssfi</h3>

<p>Sécuriser des applications en micro-service avec Keycloak.</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=2DYWyE9jkEY">Part 1 - Basic Concepts</a></li>
<li><a href="https://www.youtube.com/watch?v=hiu4uHjdWbY&amp;t=35s">Part 2 - Distributed App Use Case</a></li>
<li><a href="https://www.youtube.com/watch?v=mFJSxX9d-Cg">Part 3 - Getting Started with Keycloak</a></li>
<li><a href="https://www.youtube.com/watch?v=QksFYgRUxGQ&amp;t=188s">Part 4 - Spring MVC Application</a></li>
<li><a href="https://www.youtube.com/watch?v=NvpbR_wvPlQ&amp;t=6s">Part 5 - Spring Security Keycloak Adapter</a></li>
<li><a href="https://www.youtube.com/watch?v=grvDI2kvgsc&amp;t=4s">Part 6 - Micro-Service Rest API Bearer Only case</a></li>
<li><a href="https://www.youtube.com/watch?v=Seq2qCCwxZ0&amp;t=37s">Part 7 - Angular Application to Secure</a></li>
<li><a href="https://www.youtube.com/watch?v=5n0DhOdLxPc&amp;t=29s">Part 8 - Keycloak js in Angular App</a></li>
<li><a href="https://www.youtube.com/watch?v=nIm78BIIeFE&amp;t=27s">Part 9 - Http Authorization Header Interceptor</a></li>
<li><a href="https://www.youtube.com/watch?v=ObHhIvSILOs&amp;t=21s">Part 10 - Back to some improvements</a></li>
<li><a href="https://www.youtube.com/watch?v=13vIJR8vT3w&amp;t=110s">Part 11 - Other Concepts Themes</a></li>
</ul>

<hr />

<p>Exemple d&rsquo;implémentation, avec des tests et une application entièrement portable grâce aux containers.</p>

<h3 id="dépôts-gitlab">Dépôts Gitlab</h3>

<ul>
<li><a href="https://gitlab.com/phou.jeannory/keycloak-back-end.git">Back-end</a></li>
<li><a href="https://gitlab.com/phou.jeannory/keycloak-front-end.git">Front-end</a></li>
</ul>

<hr />

<h3 id="projet-spécificités-techniques">Projet : spécificités techniques</h3>

<ul>
<li>Serveur d&rsquo;authentification</li>
<li>Back-end en java avec Springboot</li>
<li>Front-end en Angular Material</li>
<li>Docker de la base de données Postgresql</li>
<li>Docker du serveur keycloak</li>
<li>Docker de la base de données Mysql de keycloak</li>
<li>Tests unitaires</li>
<li>Tests d&rsquo;intégration</li>
</ul>

<h3 id="projet-spécificités-fonctionnelles">Projet : spécificités fonctionnelles</h3>

<ul>
<li>L&rsquo;utilisateur peut se connecter/déconnecter</li>
<li>L&rsquo;utilisateur peut créer un compte</li>
<li>L&rsquo;utilisateur peut accéder/modifier son profil</li>
<li>L&rsquo;utilisateur disposant du rôle manager peut accéder à la liste de tous les utilisateurs</li>
</ul>

<hr />

<h2 id="serveur-d-authentification-100-portable-avec-docker">Serveur d&rsquo;authentification 100 % portable avec docker</h2>

<p>Dans une application en micro service, le serveur d&rsquo;authentification est décorélé des autres micro services. Le serveur Keycloak est déployé dans une VM.
Keycloak et ses dépendances sont buildés dans une même image docker. Ils sont donc portable d&rsquo;un environnement à un autre.
Cette image comporte le serveur standalone de Keycloak, et sa base de données MySql (répertoire dev-docker-integration-keycloak):</p>

<p>docker-compose.yml</p>

<pre><code>version: '3.1'
services:
    lab-mysql:
        container_name: mysql-dev-docker
        restart: always
        image: mysql/mysql-server
        environment:
            MYSQL_ROOT_PASSWORD: password
            MYSQL_ROOT_HOST: &quot;%&quot;
            MYSQL_DATABASE: keycloak
            MYSQL_USER: keycloak
            MYSQL_PASSWORD: password
        volumes:
            - ./../target/mysql-dev-docker:/var/lib/mysql
        ports:
            - 3306:3306
    keycloak:
        container_name: keycloak-dev-docker
        restart: always
        image: jboss/keycloak
        depends_on:
            - lab-mysql
        environment:
            DB_VENDOR: MYSQL
            DB_ADDR: lab-mysql
            DB_PORT: 3306
            DB_DATABASE: keycloak
            DB_USER: keycloak
            DB_PASSWORD: password
            KEYCLOAK_USER: admin
            KEYCLOAK_PASSWORD: 1234
        ports:
            - 8099:8080
            - 8443:8443
            - 9990:9990
        volumes:
            - ./../target/keycloak-dev-docker:/data
        links:
            - lab-mysql
</code></pre>

<hr />

<h3 id="déploiement-de-keycloak-dans-une-vm-gcp">Déploiement de Keycloak dans une VM GCP</h3>

<p>Il s&rsquo;agit d&rsquo;une petite VM sous Ubuntu Serveur (g1-small :1 vCPU, 1,7 Go de mémoire).
Il faut déployer l&rsquo;image et restaurer la base de données:</p>

<pre><code>docker-compose -f docker-compose.yml up -d
</code></pre>

<hr />

<p>Si nécessaire, récupérer l&rsquo;ip de l&rsquo;image mysql-dev-docker.</p>

<pre><code>docker inspect mysql-dev-docker
</code></pre>

<hr />

<pre><code>&quot;NetworkID&quot;: &quot;909b56f4c2caa1c594f8d691e0204cc236849fb25ddb2302bb75fcba516a8698&quot;,
&quot;EndpointID&quot;: &quot;21d1c92defc16198b971ecf87be244bcff13c3e8bb5750753c8d2c428a85685e&quot;,
&quot;Gateway&quot;: &quot;172.25.0.1&quot;,
&quot;IPAddress&quot;: &quot;172.25.0.3&quot;,
</code></pre>

<hr />

<p>Restaurer la base de données Mysql.</p>

<pre><code>cd keycloak-config
cat backup.sql | docker exec -i mysql-dev-docker /usr/bin/mysql -h '172.25.0.3' -u keycloak -ppassword keycloak
</code></pre>

<p>ou</p>

<pre><code>cd keycloak-config
cat backup.sql | docker exec -i mysql-dev-docker /usr/bin/mysql -u keycloak -ppassword keycloak
</code></pre>

<p><em>Cette configuration a un niveau de sécurité permettant l&rsquo;exposition de l&rsquo;Ihm avec le protocol http.</em></p>

<hr />

<h3 id="l-ihm-de-keycloak">L&rsquo;IHM de Keycloak</h3>

<p>Assurez-vous que le port de la VM soit ouverte en entré sur le port définis pour keycloak (8089)
Se connecter à l&rsquo;IHM :</p>

<pre><code>http://35.209.231.158:8099/auth/
</code></pre>

<p>Les crédentials figurent sur le docker-compose.yml</p>

<pre><code>KEYCLOAK_USER: admin
KEYCLOAK_PASSWORD: 1234
</code></pre>

<hr />

<p><img src="/blog/img/gitlab-15.png" alt="keycloak-realm" /></p>

<p>Le Realm correspond au royaume ou à l&rsquo;entretprise.</p>

<hr />

<p><img src="/blog/img/gitlab-16.png" alt="keycloak-clients" /></p>

<p>Les clients sont les applications de l&rsquo;entreprise. Dans notre exemple il y a 2 clients qui vont être utilisés:</p>

<ul>
<li>sc-ui (Front-end)</li>
<li>sc-user (Back-end)</li>
</ul>

<hr />

<p><img src="/blog/img/gitlab-17.png" alt="keycloak-roles" /></p>

<p>Les rôles peuvent être définis de manière globale ou pour une ou plusieurs applications (clients).</p>

<hr />

<p><img src="/blog/img/gitlab-18.png" alt="keycloak-users" /></p>

<p>Les utilisateurs sont visibles dans l&rsquo;IHM. Leurs rôles peuvent ainsi être définis.</p>

<hr />

<p><img src="/blog/img/gitlab-19.png" alt="keycloak-installations" /></p>

<p>Ces éléments vont être utiles pour créer les connecteurs des applications</p>

<hr />

<h2 id="back-end-en-java-avec-springboot">Back-end en java avec Springboot</h2>

<p>Les infos récupérés vont servir à renseigner le fichier de configuration de Springboot.</p>

<pre><code>{
&quot;realm&quot;: &quot;Sc-project&quot;,
&quot;auth-server-url&quot;: &quot;http://35.209.231.158:8099/auth/&quot;,
&quot;ssl-required&quot;: &quot;none&quot;,
&quot;resource&quot;: &quot;sc-user&quot;,
&quot;public-client&quot;: true,
&quot;confidential-port&quot;: 0
}
</code></pre>

<p>Le nom de domaine <a href="http://jeannory.ovh">http://jeannory.ovh</a> pointe bien évidement vers l&rsquo;ip externe <a href="http://35.209.231.158">http://35.209.231.158</a></p>

<p>Le profil dev-docker-integration va servir pour les étapes de CI/CD. Gitlab va se connecter à cette VM afin de réaliser tous les tests d&rsquo;intégration.</p>

<pre><code>---

spring:
profiles: dev-docker-integration

jpa:
    database: POSTGRESQL
    show-sql: true
    hibernate:
    ddl-auto: create-drop

datasource:
    platform: postgres
    url: jdbc:postgresql://jeannory.dynamic-dns.net:5432/keycloak_back_end_db
    username: user1
    password: 1234!*MyJea@99
    driverClassName: org.postgresql.Driver
    initialization-mode: always

keycloak:
realm: Sc-project
auth-server-url: http://jeannory.ovh:8099/auth/
resource: sc-user
public-client: false
bearer-only: true
cors: true


sc-properties:
authServerUrl: http://jeannory.ovh:8099/auth/
authServerParameters: realms/Sc-project/protocol/openid-connect/token

---
</code></pre>

<hr />

<p>La redéfinition de la méthode <em>configure</em> permet une protection des end-points en fonction des rôles</p>

<pre><code>@KeycloakConfiguration
public class KeycloakSpringSecurityConfig extends KeycloakWebSecurityConfigurerAdapter {

    @Override
    protected SessionAuthenticationStrategy sessionAuthenticationStrategy() {
        return new RegisterSessionAuthenticationStrategy(new SessionRegistryImpl());
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception{
        auth.authenticationProvider(new KeycloakAuthenticationProvider());
    }

    @Override
    protected void configure(HttpSecurity http)throws Exception{
        super.configure(http);
        http.authorizeRequests().antMatchers(&quot;/api/users/connected-user&quot;).hasAuthority((&quot;user&quot;));
        http.authorizeRequests().antMatchers(&quot;/api/users&quot;).hasAuthority((&quot;manager&quot;));
        http.authorizeRequests().antMatchers(&quot;/api/spaces/**&quot;).hasAuthority((&quot;manager&quot;));
    }

}
</code></pre>

<hr />

<p>Ces méthodes permettent de récupérer les infos de l&rsquo;utilisateurs dans le security context de l&rsquo;application.</p>

<pre><code>@Component
public class KeycloakSecurityContext {

    /**
    *
    * @return roles
    */
    public OidcKeycloakAccount getOidcKeycloakAccount(){
        return getKeycloakAuthenticationToken().getAccount();
    }

    /**
    *
    * @return preferredUsername, email, givenName, familyName
    */
    public AccessToken getAccessToken(){
        return getOidcKeycloakAccount().getKeycloakSecurityContext().getToken();
    }

    @Bean
    @Scope(scopeName = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
    private KeycloakAuthenticationToken getKeycloakAuthenticationToken(){
        return (KeycloakAuthenticationToken) ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest().getUserPrincipal();
    }

}
</code></pre>

<hr />

<p>La méthode getAccessToken() permet ainsi de récupérer le username (accessToken.getPreferredUsername()), pour s&rsquo;en servir par la suite.</p>

<pre><code>@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private KeycloakSecurityContext keycloakSecurityContext;

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private SpaceRepository spaceRepository;

    @Autowired
    @Qualifier(&quot;UserUserDtoConverter&quot;)
    private SuperConverter&lt;User, UserDto&gt; converter;

    @Override
    public UserDto getConnectedUserDto() {
        try {
            return converter.toDto(getConnectedUser());
        } catch (CustomServiceException ex) {
            return null;
        }
    }

    @Override
    public List&lt;UserDto&gt; getAllUsers(final Integer pageNo, final Integer pageSize, final String sortBy) {
        final Pageable paging = PageRequest.of(pageNo, pageSize, Sort.by(sortBy));
        final Page&lt;User&gt; pagedResult = userRepository.findAll(paging);
        if(pagedResult.hasContent()) {
            return converter.toDtos(pagedResult.getContent());
        } else {
            return new ArrayList&lt;&gt;();
        }
    }



    //catch CustomTransactionalException in this method
    private User getConnectedUser() {
        final AccessToken accessToken = keycloakSecurityContext.getAccessToken();
        if (accessToken == null) {
            throw new CustomServiceException(&quot;error getAccessToken failed&quot;);
        } else if (accessToken.getPreferredUsername() == null || accessToken.getPreferredUsername().isEmpty()) {
            throw new CustomServiceException(&quot;error preferredUsername cannot be null or empty&quot;);
        }
        final String username = accessToken.getPreferredUsername();
        User user = userRepository.findByUsernameIgnoreCase(username);
        if (user == null) {
            try {
                user = testCreateUser(accessToken);
            } catch (CustomTransactionalException ex) {
                return null;
            }
        }
        return user;
    }

    // Do not catch CustomTransactionalException in this method
    @Transactional(propagation = Propagation.REQUIRES_NEW,
            rollbackFor = CustomTransactionalException.class)
    private User testCreateUser(final AccessToken accessToken) {
        return validateCreateUser(accessToken);
    }

    // MANDATORY: Transaction must be created before.
    @Transactional(propagation = Propagation.MANDATORY)
    private User validateCreateUser(final AccessToken accessToken) {
        try {
            final Space space = new Space(null, accessToken.getPreferredUsername() + &quot;_space&quot;, null);
            spaceRepository.save(space);
            final User user = new User();
            user.setUsername(accessToken.getPreferredUsername());
            user.setEmail(accessToken.getEmail());
            user.setFirstName(accessToken.getGivenName());
            user.setLastName(accessToken.getFamilyName());
            user.setSpace(space);
            userRepository.save(user);
            return userRepository.findByUsernameIgnoreCase(accessToken.getPreferredUsername());
        } catch (Exception ex) {
            throw new CustomTransactionalException(&quot;persistence failed : &quot; + ex.getMessage());
        }
    }

}
</code></pre>

<hr />

<p>Ces quelques classes/fichier de configuation permettent une très rapide implémentation d&rsquo;un projet back-end avec une sécurisation optimale.</p>

<h3 id="déploiement-du-back-end-et-serveur-keycloak-100-sur-son-local">Déploiement du Back-end et serveur Keycloak 100% sur son local</h3>

<p>Build les images de Postgresql, Keycloak et sa bdd MySql (répertoire dev-docker).</p>

<pre><code>cd dev-docker
docker-compose -f docker-compose.yml up -d
</code></pre>

<p>docker-compose.yml.</p>

<pre><code>version: '3.1'
services:
    db:
        image: postgres
        container_name: postgresql-dev-docker
        restart: always
        environment:
            POSTGRES_DB: keycloak_back_end_db
            POSTGRES_PASSWORD: 1234!*MyJea@99
            POSTGRES_USER: user1
        volumes:
            - ./../target/postgresql-dev-docker:/var/lib/postgresql/data
        ports:
            - 5432:5432
    lab-mysql:
        container_name: mysql-dev-docker
        restart: always
        image: mysql/mysql-server
        environment:
            MYSQL_ROOT_PASSWORD: password
            MYSQL_ROOT_HOST: &quot;%&quot;
            MYSQL_DATABASE: keycloak
            MYSQL_USER: keycloak
            MYSQL_PASSWORD: password
        volumes:
            - ./../target/mysql-dev-docker:/var/lib/mysql
        ports:
            - 3306:3306
    keycloak:
        container_name: keycloak-dev-docker
        restart: always
        image: jboss/keycloak
        depends_on:
            - lab-mysql
        environment:
            DB_VENDOR: MYSQL
            DB_ADDR: lab-mysql
            DB_PORT: 3306
            DB_DATABASE: keycloak
            DB_USER: keycloak
            DB_PASSWORD: password
            KEYCLOAK_USER: admin
            KEYCLOAK_PASSWORD: 1234
        ports:
            - 8099:8080
            - 8443:8443
            - 9990:9990
        volumes:
            - ./../target/keycloak-dev-docker:/data
        links:
            - lab-mysql
</code></pre>

<hr />

<p>Vérifier que les images ont bien été déployées.</p>

<pre><code>docker ps -a
</code></pre>

<hr />

<pre><code>CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                             PORTS                                                                    NAMES
de2face102da        jboss/keycloak       &quot;/opt/jboss/tools/do…&quot;   22 seconds ago      Up 16 seconds                      0.0.0.0:8443-&gt;8443/tcp, 0.0.0.0:9990-&gt;9990/tcp, 0.0.0.0:8099-&gt;8080/tcp   keycloak-dev-docker
2909874a449a        postgres             &quot;docker-entrypoint.s…&quot;   33 seconds ago      Up 24 seconds                      0.0.0.0:5432-&gt;5432/tcp                                                   postgresql-dev-docker
1cef41fa3f93        mysql/mysql-server   &quot;/entrypoint.sh mysq…&quot;   33 seconds ago      Up 23 seconds (health: starting)   0.0.0.0:3306-&gt;3306/tcp, 33060/tcp                                        mysql-dev-docker
</code></pre>

<hr />

<p>Si nécessaire, récupérer l&rsquo;ip de l&rsquo;image mysql-dev-docker.</p>

<pre><code>docker inspect mysql-dev-docker
</code></pre>

<hr />

<pre><code>&quot;NetworkID&quot;: &quot;909b56f4c2caa1c594f8d691e0204cc236849fb25ddb2302bb75fcba516a8698&quot;,
&quot;EndpointID&quot;: &quot;21d1c92defc16198b971ecf87be244bcff13c3e8bb5750753c8d2c428a85685e&quot;,
&quot;Gateway&quot;: &quot;172.25.0.1&quot;,
&quot;IPAddress&quot;: &quot;172.25.0.3&quot;,
</code></pre>

<hr />

<p>Restaurer la base de données Mysql.</p>

<pre><code>cd keycloak-config
cat backup.sql | docker exec -i mysql-dev-docker /usr/bin/mysql -h '172.25.0.3' -u keycloak -ppassword keycloak
</code></pre>

<p>ou</p>

<pre><code>cd keycloak-config
cat backup.sql | docker exec -i mysql-dev-docker /usr/bin/mysql -u keycloak -ppassword keycloak
</code></pre>

<hr />

<p>Un warning indique qu&rsquo;il n&rsquo;est pas recommandé de renseigner le password dans une ligne de commande&hellip;</p>

<pre><code>mysql: [Warning] Using a password on the command line interface can be insecure.
</code></pre>

<hr />

<p>Si soucis de lancement de keycloak apres la restauration de la base de données.</p>

<pre><code>CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                          PORTS                               NAMES
c3246b20fde4        jboss/keycloak       &quot;/opt/jboss/tools/do…&quot;   3 minutes ago       Restarting (1) 11 seconds ago                                       keycloak-dev-docker
99c412204936        postgres             &quot;docker-entrypoint.s…&quot;   3 minutes ago       Up 3 minutes                    0.0.0.0:5432-&gt;5432/tcp              postgresql-dev-docker
ed42957b5ff5        mysql/mysql-server   &quot;/entrypoint.sh mysq…&quot;   3 minutes ago       Up 3 minutes (healthy)          0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   mysql-dev-docker
</code></pre>

<hr />

<p>Il faut arrêter/supprimer les images.</p>

<pre><code>docker stop keycloak-dev-docker
docker rm keycloak-dev-docker
docker stop postgresql-dev-docker
docker rm postgresql-dev-docker
docker stop mysql-dev-docker
docker rm mysql-dev-docker
docker system prune -a
</code></pre>

<hr />

<pre><code>Total reclaimed space: 1.339GB
</code></pre>

<hr />

<p>Rebuild et déployer les images.</p>

<pre><code>cd dev-docker
docker-compose -f docker-compose.yml up -d
</code></pre>

<hr />

<p>En relancant la commande docker ps -a nous constatons que tout est rentré dans l&rsquo;ordre.</p>

<pre><code>CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                             PORTS                                                                    NAMES
97b1d64bf536        jboss/keycloak       &quot;/opt/jboss/tools/do…&quot;   25 seconds ago      Up 18 seconds                      0.0.0.0:8443-&gt;8443/tcp, 0.0.0.0:9990-&gt;9990/tcp, 0.0.0.0:8099-&gt;8080/tcp   keycloak-dev-docker
3b9e6f4a82e3        postgres             &quot;docker-entrypoint.s…&quot;   38 seconds ago      Up 23 seconds                      0.0.0.0:5432-&gt;5432/tcp                                                   postgresql-dev-docker
2bd8051a1850        mysql/mysql-server   &quot;/entrypoint.sh mysq…&quot;   38 seconds ago      Up 24 seconds (health: starting)   0.0.0.0:3306-&gt;3306/tcp, 33060/tcp                                        mysql-dev-docker
</code></pre>

<hr />

<h3 id="les-profils-maven-et-springboot">Les profils maven et Springboot</h3>

<p>Un profil maven a été définis par défaut. Il permet de lancer l&rsquo;application sans exécuter de test.</p>

<pre><code>    &lt;!--profile by default                              --&gt;
    &lt;!--no junit or integration tests in this profile   --&gt;
    &lt;profile&gt;
        &lt;id&gt;dev&lt;/id&gt;
        &lt;activation&gt;
            &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
        &lt;/activation&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
                &lt;scope&gt;test&lt;/scope&gt;
                &lt;exclusions&gt;
                    &lt;exclusion&gt;
                        &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                        &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                    &lt;/exclusion&gt;
                &lt;/exclusions&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/profile&gt;
</code></pre>

<hr />

<p>Le profil dev-docker permet de lacer exclusivement les tests unitaires.</p>

<pre><code>    &lt;!--profile for gitlab-ci                                       --&gt;
    &lt;!--all junit tests in this profile                             --&gt;
    &lt;!--command                                                     --&gt;
    &lt;!--mvn test -Pdev-docker -Dspring.profiles.active=dev-docker   --&gt;
    &lt;profile&gt;
        &lt;id&gt;dev-docker&lt;/id&gt;
        &lt;activation&gt;
            &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
        &lt;/activation&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
        &lt;build&gt;
            &lt;plugins&gt;
                &lt;!-- exclude integration tests--&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.0.0-M1&lt;/version&gt;
                    &lt;configuration&gt;
                        &lt;excludes&gt;
                            &lt;exclude&gt;**/KeycloakApplicationTests*.java&lt;/exclude&gt;
                            &lt;exclude&gt;**/UserControllerContextTest*.java&lt;/exclude&gt;
                            &lt;exclude&gt;**/SpaceControllerContextTest*.java&lt;/exclude&gt;
                        &lt;/excludes&gt;
                    &lt;/configuration&gt;
                &lt;/plugin&gt;
            &lt;/plugins&gt;
        &lt;/build&gt;
    &lt;/profile&gt;
</code></pre>

<hr />

<p>Le profil dev-docker-integration-testing permet de ne lancer que les tests d&rsquo;intégration</p>

<pre><code>    &lt;!--profile for gitlab-ci                                       --&gt;
    &lt;!--only integration tests in this profile                      --&gt;
    &lt;!--command                                                     --&gt;
    &lt;!--mvn test -Pdev-docker-integration-testing -Dspring.profiles.active=dev-docker   --&gt;
    &lt;profile&gt;
        &lt;id&gt;dev-docker-integration-testing&lt;/id&gt;
        &lt;activation&gt;
            &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
        &lt;/activation&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
        &lt;build&gt;
            &lt;plugins&gt;
                &lt;!-- only integration tests--&gt;
                &lt;plugin&gt;
                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                    &lt;version&gt;3.0.0-M1&lt;/version&gt;
                    &lt;configuration&gt;
                        &lt;excludes&gt;
                            &lt;exclude&gt;**/SpaceSpaceDtoConverterTest*.java&lt;/exclude&gt;
                            &lt;exclude&gt;**/UserUserDtoConverterTest*.java&lt;/exclude&gt;
                            &lt;exclude&gt;**/UserServiceImplTest*.java&lt;/exclude&gt;
                            &lt;exclude&gt;**/UserServiceImplTest*.java&lt;/exclude&gt;
                        &lt;/excludes&gt;
                    &lt;/configuration&gt;
                &lt;/plugin&gt;
            &lt;/plugins&gt;
        &lt;/build&gt;
    &lt;/profile&gt;
</code></pre>

<hr />

<p>La combinaison de ces 3 profiles permettra l&rsquo;exécution de plusiseurs étapes d&rsquo;intégration et de déployement continue (voir le chapitre sur gitlab ci/cd).</p>

<hr />

<p>Pour un déploiement en local ou pour compléter les tâches de ci/cd, la combinaison avec les profils Springboot va permettre de charger des variables sur un projet déjà compilés.</p>

<hr />

<pre><code>spring:
    profiles: dev-docker

    jpa:
        database: POSTGRESQL
        show-sql: true
        hibernate:
            ddl-auto: create-drop

    datasource:
        platform: postgres
        url: jdbc:postgresql://localhost:5432/keycloak_back_end_db
        username: user1
        password: 1234!*MyJea@99
        driverClassName: org.postgresql.Driver
        initialization-mode: always

keycloak:
    realm: Sc-project
    auth-server-url: http://localhost:8099/auth/
    resource: sc-user
    public-client: false
    bearer-only: true
    cors: true

sc-properties:
    authServerUrl: http://localhost:8099/auth/
    authServerParameters: realms/Sc-project/protocol/openid-connect/token
</code></pre>

<p>Le profil dev-docker permet un déploiement en local et les tests unitaires.</p>

<hr />

<pre><code>spring:
    profiles: dev-docker-integration

    jpa:
        database: POSTGRESQL
        show-sql: true
        hibernate:
            ddl-auto: create-drop

    datasource:
        platform: postgres
        url: jdbc:postgresql://jeannory.dynamic-dns.net:5432/keycloak_back_end_db
        username: user1
        password: 1234!*MyJea@99
        driverClassName: org.postgresql.Driver
        initialization-mode: always

keycloak:
    realm: Sc-project
    auth-server-url: http://jeannory.ovh:8099/auth/
    resource: sc-user
    public-client: false
    bearer-only: true
    cors: true


sc-properties:
    authServerUrl: http://jeannory.ovh:8099/auth/
    authServerParameters: realms/Sc-project/protocol/openid-connect/token
</code></pre>

<p>Le profil dev-docker-integration va être utilisé pour les tests d&rsquo;intégration.</p>

<hr />

<pre><code>spring:
    profiles: dev-docker-integration-deploy

jpa:
    database: POSTGRESQL
    show-sql: true
    hibernate:
        ddl-auto: create-drop

datasource:
    platform: postgres
    url: jdbc:postgresql://localhost:5432/keycloak_back_end_db
    username: user1
    password: 1234!*MyJea@99
    driverClassName: org.postgresql.Driver
    initialization-mode: always

keycloak:
    realm: Sc-project
    auth-server-url: http://jeannory.ovh:8099/auth/
    resource: sc-user
    public-client: false
    bearer-only: true
    cors: true
    ssl-required: none

sc-properties:
    authServerUrl: http://jeannory.ovh:8099/auth/
    authServerParameters: realms/Sc-project/protocol/openid-connect/token
</code></pre>

<p>Enfin le profil dev-docker-integration-deploy va être utilisé pour le déploiement du projet.</p>

<hr />

<h3 id="les-tests-unitaires">Les tests unitaires</h3>

<p>Ce projet comporte des tests unitaires. La méthode <em>getConnectedUserDto</em> a été contruite par les tests (principe du test first).</p>

<p>Méthode :</p>

<pre><code>@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private KeycloakSecurityContext keycloakSecurityContext;

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private SpaceRepository spaceRepository;

    @Autowired
    @Qualifier(&quot;UserUserDtoConverter&quot;)
    private SuperConverter&lt;User, UserDto&gt; converter;

    @Override
    public UserDto getConnectedUserDto() {
        try {
            return converter.toDto(getConnectedUser());
        } catch (CustomServiceException ex) {
            return null;
        }
    }

    //catch CustomTransactionalException in this method
    private User getConnectedUser() {
        final AccessToken accessToken = keycloakSecurityContext.getAccessToken();
        if (accessToken == null) {
            throw new CustomServiceException(&quot;error getAccessToken failed&quot;);
        } else if (accessToken.getPreferredUsername() == null || accessToken.getPreferredUsername().isEmpty()) {
            throw new CustomServiceException(&quot;error preferredUsername cannot be null or empty&quot;);
        }
        final String username = accessToken.getPreferredUsername();
        User user = userRepository.findByUsernameIgnoreCase(username);
        if (user == null) {
            try {
                user = testCreateUser(accessToken);
            } catch (CustomTransactionalException ex) {
                return null;
            }
        }
        return user;
    }

    // Do not catch CustomTransactionalException in this method
    @Transactional(propagation = Propagation.REQUIRES_NEW,
            rollbackFor = CustomTransactionalException.class)
    private User testCreateUser(final AccessToken accessToken) {
        return validateCreateUser(accessToken);
    }

    // MANDATORY: Transaction must be created before.
    @Transactional(propagation = Propagation.MANDATORY)
    private User validateCreateUser(final AccessToken accessToken) {
        try {
            final Space space = new Space(null, accessToken.getPreferredUsername() + &quot;_space&quot;, null);
            spaceRepository.save(space);
            final User user = new User();
            user.setUsername(accessToken.getPreferredUsername());
            user.setEmail(accessToken.getEmail());
            user.setFirstName(accessToken.getGivenName());
            user.setLastName(accessToken.getFamilyName());
            user.setSpace(space);
            userRepository.save(user);
            return userRepository.findByUsernameIgnoreCase(accessToken.getPreferredUsername());
        } catch (Exception ex) {
            throw new CustomTransactionalException(&quot;persistence failed : &quot; + ex.getMessage());
        }
    }

}
</code></pre>

<hr />

<p>Class de test :</p>

<pre><code>public class UserServiceImplTest {

    @InjectMocks
    private UserServiceImpl userService;

    @Mock
    private KeycloakSecurityContext keycloakSecurityContext;

    @Mock
    private UserRepository userRepository;

    @Mock
    private SpaceRepository spaceRepository;

    @Mock
    private SuperConverter&lt;User, UserDto&gt; converter;

    @Before
    public void setUp() throws Exception {
        MockitoAnnotations.initMocks(this);
    }

    @Test
    public void testGetConnectedUserDtoWhenUserExistsReturnDto() {
        //given
        final AccessToken accessToken = Mockito.spy(new AccessToken());
        accessToken.setPreferredUsername(&quot;XLD&quot;);
        Mockito.when(keycloakSecurityContext.getAccessToken()).thenReturn(accessToken);
        final User user = new User();
        user.setUsername(&quot;XLD&quot;);
        Mockito.when(userRepository.findByUsernameIgnoreCase(Mockito.anyString())).thenReturn(user);
        final UserDto userDto = new UserDto();
        userDto.setUsername(&quot;XLD&quot;);
        Mockito.when(converter.toDto(user)).thenReturn(userDto);

        //when
        final UserDto result = userService.getConnectedUserDto();

        //then
        assertEquals(&quot;XLD&quot;, result.getUsername());
    }

    @Test
    public void testGetConnectedUserDtoWhenUserExistsReturnDtoBis() {
        //given
        Mockito.when(keycloakSecurityContext.getAccessToken()).thenReturn(BuilderUtils.getAccessToken());
        Mockito.when(userRepository.findByUsernameIgnoreCase(Mockito.anyString())).thenReturn(BuilderUtils.getUser());
        Mockito.when(converter.toDto(BuilderUtils.getUser())).thenReturn(BuilderUtils.getUserDto());

        //when
        final UserDto result = userService.getConnectedUserDto();

        //then
        assertEquals(1L, (long) result.getId());
        assertEquals(&quot;user1&quot;,result.getUsername());
        assertEquals(&quot;user1@gmail.com&quot;,result.getEmail());
        assertEquals(Gender.Mister,result.getGender());
        assertEquals(&quot;firstName1&quot;,result.getFirstName());
        assertEquals(&quot;name1&quot;,result.getLastName());
        assertEquals(Status.ACTIVE,result.getStatus());
        assertEquals(&quot;user1_space&quot;, result.getSpace().getName());
    }

    @Test
    public void testGetConnectedUserDtoWhenUserNoExistsReturnDto() {
        //given
        final AccessToken accessToken = Mockito.spy(new AccessToken());
        accessToken.setPreferredUsername(&quot;XLD&quot;);
        Mockito.when(keycloakSecurityContext.getAccessToken()).thenReturn(accessToken);
        Mockito.when(userRepository.findByUsernameIgnoreCase(Mockito.anyString())).thenReturn(null);
        final Space space = new Space();
        space.setId(1L);
        space.setName(&quot;XLD_space&quot;);

        Mockito.when(spaceRepository.save(Mockito.any(Space.class))).thenReturn(space);
        final User user = new User();
        user.setId(1L);
        user.setUsername(&quot;XLD&quot;);
        user.setSpace(space);
        Mockito.when(userRepository.save(Mockito.any(User.class))).thenReturn(user);
        Mockito.when(userRepository.findByUsernameIgnoreCase(Mockito.anyString())).thenReturn(user);

        final SpaceDto spaceDto = new SpaceDto();
        spaceDto.setName(&quot;XLD_space&quot;);

        final UserDto userDto = new UserDto();
        userDto.setUsername(&quot;XLD&quot;);
        userDto.setSpace(spaceDto);
        Mockito.when(converter.toDto(user)).thenReturn(userDto);

        //when
        final UserDto result = userService.getConnectedUserDto();
        result.toString();

        //then
        assertEquals(&quot;XLD&quot;, result.getUsername());
    }

    @Test
    public void testGetConnectedUserWhenGetAccessTokenIsNullThenThrowExceptionReturnNull(){
        //given
        Mockito.when(keycloakSecurityContext.getAccessToken()).thenReturn(null);

        //when
        final UserDto result = userService.getConnectedUserDto();

        //then
        assertNull(&quot;return null&quot;, result);
    }

    @Test
    public void testGetConnectedUserWhenPreferredUsernameIsNullThenThrowExceptionReturnNull() {
        //given
        final AccessToken accessToken = Mockito.spy(new AccessToken());
        Mockito.when(keycloakSecurityContext.getAccessToken()).thenReturn(accessToken);

        //when
        final UserDto result = userService.getConnectedUserDto();

        //then
        assertNull(&quot;return null&quot;, result);
    }

    @Test
    public void testGetConnectedUserWhenPreferredUsernameIsEmptyThenThrowExceptionReturnNull() {
        //given
        final AccessToken accessToken = Mockito.spy(new AccessToken());
        accessToken.setPreferredUsername(&quot;&quot;);
        Mockito.when(keycloakSecurityContext.getAccessToken()).thenReturn(accessToken);

        //when
        final UserDto result = userService.getConnectedUserDto();

        //then
        assertNull(&quot;return null&quot;, result);
    }

    @Test
    public void testGetConnectedUserWhenSpaceSaveFailedThenThrowExceptionReturnNull() {
        //given
        final AccessToken accessToken = Mockito.spy(new AccessToken());
        accessToken.setPreferredUsername(&quot;XLD&quot;);
        Mockito.when(keycloakSecurityContext.getAccessToken()).thenReturn(accessToken);
        Mockito.when(userRepository.findByUsernameIgnoreCase(Mockito.anyString())).thenReturn(null);
        final Space space = new Space();
        space.setName(&quot;XLD_space&quot;);
        Mockito.when(spaceRepository.save(Mockito.any(Space.class))).thenThrow(new CustomTransactionalException());

        //when
        final UserDto result = userService.getConnectedUserDto();

        //then
        assertNull(&quot;return null&quot;, result);
    }

    @Test
    public void testGetConnectedUserWhenUserSaveFailedThenThrowExceptionReturnNull() {
        //given
        final AccessToken accessToken = Mockito.spy(new AccessToken());
        accessToken.setPreferredUsername(&quot;XLD&quot;);
        Mockito.when(keycloakSecurityContext.getAccessToken()).thenReturn(accessToken);
        Mockito.when(userRepository.findByUsernameIgnoreCase(Mockito.anyString())).thenReturn(null);
        final User user = new User();
        user.setUsername(&quot;XLD&quot;);
        Mockito.when(userRepository.save(Mockito.any(User.class))).thenThrow(new CustomTransactionalException());
        final Space space = new Space();
        space.setName(&quot;XLD_space&quot;);
        space.setUser(user);
        Mockito.when(spaceRepository.save(Mockito.any(Space.class))).thenReturn(space);

        //when
        final UserDto result = userService.getConnectedUserDto();

        //then
        assertNull(&quot;return null&quot;, result);
    }
}
</code></pre>

<hr />

<h3 id="les-tests-d-intégration">Les tests d&rsquo;intégration</h3>

<p>Ce projet dispose de tests d&rsquo;intégration.
Il est nécessaire de diposer d&rsquo;un environnement complet, un serveur d&rsquo;authentification et la base de donnée du projet.
Ces tests pourront être lancés en local ou depuis gitlab. Il faut pour cela charger le profil maven et Springboot adéquat.</p>

<pre><code>/**
* Initialize spring context before the class
*/
@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
/**
* ActiveProfiles must be launch by maven
* mvn test -Pdev-local -Dspring.profiles.active=dev-local
*/
//@ActiveProfiles(&quot;dev-docker&quot;)
@DirtiesContext(classMode = DirtiesContext.ClassMode.BEFORE_CLASS)
public class UserControllerContextTest extends BuilderUtilsResultAction {
    @Autowired
    private BuilderUtilsKeycloak builderUtilsKeycloak;

    @Test
    public void getGetUsersShouldReturnForbiddenWhenRoleIsUser() throws Exception {
        final String accessToken = builderUtilsKeycloak.getAccessToken(&quot;test&quot;, &quot;1234&quot;);
        final MvcResult mvcResult = invokeGet(&quot;/api/users&quot;, accessToken)
                .andExpect(status().isForbidden())
                .andReturn();
    }

    @Test
    public void testGetUsersWhenRoleIsManagerShouldReturn9() throws Exception {
        final String accessToken = builderUtilsKeycloak.getAccessToken(&quot;phou.jeannory@gmail.com&quot;, &quot;1234&quot;);
        final MultiValueMap&lt;String, String&gt; parameters = new LinkedMultiValueMap&lt;&gt;();
        parameters.put(&quot;pageNo&quot;, Collections.singletonList(&quot;0&quot;));
        parameters.put(&quot;pageSize&quot;, Collections.singletonList(&quot;9&quot;));
        parameters.put(&quot;sortBy&quot;, Collections.singletonList(&quot;id&quot;));
        final MvcResult mvcResult = invokeGet(&quot;/api/users&quot;, accessToken, parameters)
                .andExpect(status().isOk())
                .andExpect(jsonPath(&quot;$&quot;,hasSize(9)))
                .andExpect(jsonPath(&quot;$[0].username&quot;, is(&quot;user1&quot;)))
                .andReturn();
    }

    @Test
    public void testGetConnectedUser() throws Exception {
        final String accessToken = builderUtilsKeycloak.getAccessToken(&quot;test&quot;, &quot;1234&quot;);
        final MvcResult mvcResult = invokeGet(&quot;/api/users/connected-user&quot;, accessToken)
                .andExpect(status().isOk())
                .andExpect(jsonPath(&quot;email&quot;, is(&quot;test@gmail.com&quot;)))
                .andExpect(jsonPath(&quot;space.name&quot;, is(&quot;test_space&quot;)))
                .andReturn();
    }

}
</code></pre>

<p>Pour le mode local la commande est :</p>

<pre><code>mvn test -Pdev-local -Dspring.profiles.active=dev-docker
</code></pre>

<hr />

<h2 id="le-front-end-avec-angular-material">Le front-end avec Angular Material</h2>

<h3 id="le-projet-et-ses-dépendances">Le projet et ses dépendances</h3>

<p>Le front-end a été réalisé depuis un projet sous licence MIT : Material Dashboard Angular.
Récupérer le à l&rsquo;addresse suivante : <a href="https://www.creative-tim.com/product/material-dashboard-angular2">https://www.creative-tim.com/product/material-dashboard-angular2</a> (format zip).</p>

<p><img src="/blog/img/gitlab-20.png" alt="Angular Material" /></p>

<p>Une fois le projet dézippé dans un répertoire local, télécharger toutes les dépendances.</p>

<pre><code>npm i
</code></pre>

<hr />

<p>Rendez-vous sur le site de keycloak-js et installer la librairie</p>

<p><img src="/blog/img/gitlab-21.png" alt="keycloak js" /></p>

<pre><code>npm i keycloak-js --save
</code></pre>

<hr />

<p>Il faut rajouter dans le fichier angular.json <em>&ldquo;node_modules/keycloak-js/dist/keycloak.min.js&rdquo;</em></p>

<pre><code>&quot;scripts&quot;: [
    &quot;node_modules/jquery/dist/jquery.js&quot;,
    &quot;node_modules/popper.js/dist/umd/popper.js&quot;,
    &quot;node_modules/bootstrap-material-design/dist/js/bootstrap-material-design.min.js&quot;,
    &quot;node_modules/arrive/src/arrive.js&quot;,
    &quot;node_modules/moment/moment.js&quot;,
    &quot;node_modules/perfect-scrollbar/dist/perfect-scrollbar.min.js&quot;,
    &quot;node_modules/bootstrap-notify/bootstrap-notify.js&quot;,
    &quot;node_modules/chartist/dist/chartist.js&quot;,
    &quot;node_modules/keycloak-js/dist/keycloak.min.js&quot;
]
</code></pre>

<h3 id="les-variables-d-environnement">Les variables d&rsquo;environnement</h3>

<p>Pour commencer il faut setter les variables à l&rsquo;application</p>

<p>environment.ts</p>

<pre><code>export const environment = {
SC_USER_BASE_URL: 'localhost',
SC_USER_PORT: '8081',
AUTH_BASE_URL: 'localhost',
AUTH_PORT: '8099',
// APP_VERSION: version,
production: false,
};
</code></pre>

<hr />

<p>environment.prod.ts</p>

<pre><code>export const environment = {
SC_USER_BASE_URL: 'jeannory.dynamic-dns.net',
SC_USER_PORT: '8081',
AUTH_BASE_URL: 'jeannory.ovh',
AUTH_PORT: '8099',
// APP_VERSION: version,
production: true,
};
</code></pre>

<hr />

<p>Toutes les urls sont regroupées dans des variables statics</p>

<p>Générer la class</p>

<pre><code>ng g class utils/ApiUrl
</code></pre>

<hr />

<p>api-url.ts</p>

<pre><code>    import { environment } from '../../environments/environment';

export class ApiUrl {
    private static readonly BASE_SC_USER_URL = `http://${environment.SC_USER_BASE_URL}:${environment.SC_USER_PORT}`;
    private static readonly BASE_API = '/api';
    private static readonly USERS = '/users';
    private static readonly CONNECTED_USER = '/connected-user'
    private static readonly AUTH = '/auth/'
    private static readonly AUTH_SERVER = `http://${environment.AUTH_BASE_URL}:${environment.AUTH_PORT}`;

    static get GET_CONNECTED_USER(): string {
        return `${this.BASE_SC_USER_URL}${this.BASE_API}${this.USERS}${this.CONNECTED_USER}`;
    }

    static get GET_USERS(): string {
        return `${this.BASE_SC_USER_URL}${this.BASE_API}${this.USERS}`;
    }

    static get GET_AUTH_SERVER(): string {
        return `${this.AUTH_SERVER}${this.AUTH}`;
    }
}
</code></pre>

<h3 id="implémentation-de-keycloak">Implémentation de keycloak</h3>

<p>Voici les étapes nécessaires</p>

<p>Créer le service KeycloakSecurity</p>

<pre><code>ng g service services/KeycloakSecurity
</code></pre>

<hr />

<pre><code>import { Injectable } from '@angular/core';
import { ApiUrl } from '../utils/api-url';

declare var Keycloak: any;
@Injectable({
providedIn: 'root'
})
export class KeycloakSecurityService {

public kc;
apiUrl = ApiUrl;

constructor() { }
init() {
    return new Promise((resolve, reject) =&gt; {
    console.log('security Initialisation ...');
    this.kc = new Keycloak({
        url: this.apiUrl.GET_AUTH_SERVER,
        realm: 'Sc-project',
        clientId: 'sc-ui'
    });
    this.kc.init({
        onLoad: 'check-sso',
        promiseType: 'native'
    }).then((authenticated) =&gt; {
        console.log(this.kc.token);
        resolve({ auth: authenticated, token: this.kc.token });
    }).catch(err =&gt; {
        reject(err);
    });
    });
}

}
</code></pre>

<p>&hellip;</p>

<p>Puis créer le service RequestInterceptor qui implements HttpInterceptor.
La redéfinition des méthodes de HttpInterceptor permet d&rsquo;ajouter un header à chaque requête et récupérer tous les status codes des responses serveurs (cette fonction ne sera pas implémenter ici)</p>

<pre><code>ng g service services/RequestInterceptor
</code></pre>

<hr />

<pre><code>import { Injectable } from '@angular/core';
import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent } from '@angular/common/http';
import { KeycloakSecurityService } from './keycloak-security.service';
import { Observable } from 'rxjs';

@Injectable({
providedIn: 'root'
})
export class RequestInterceptorService implements HttpInterceptor{

constructor(private securityService: KeycloakSecurityService) { }

intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {
    console.log('Request Http Interceptor ...');
    if (!this.securityService.kc.authenticated) {
    return next.handle(req);
    } else {
    const request = req.clone({
        setHeaders: {
        Authorization: 'Bearer ' + this.securityService.kc.token
        }
    });
    return next.handle(request);
    }
}
}
</code></pre>

<p>Modifier app.module.ts comme tel</p>

<pre><code>import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
import { NgModule, DoBootstrap, ApplicationRef } from '@angular/core';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { HttpModule } from '@angular/http';
import { RouterModule } from '@angular/router';
import { AppRoutingModule } from './app.routing';
import { ComponentsModule } from './components/components.module';
import { AppComponent } from './app.component';
import {
AgmCoreModule
} from '@agm/core';
import { AdminLayoutComponent } from './layouts/admin-layout/admin-layout.component';
import { KeycloakSecurityService } from './services/keycloak-security.service';
import { HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';
import { RequestInterceptorService } from './services/request-interceptor.service';
import { MatSnackBarModule } from '@angular/material/snack-bar';

const securityService = new KeycloakSecurityService();

@NgModule({
imports: [
    BrowserAnimationsModule,
    FormsModule,
    ReactiveFormsModule,
    HttpModule,
    ComponentsModule,
    RouterModule,
    AppRoutingModule,
    AgmCoreModule.forRoot({
    apiKey: 'YOUR_GOOGLE_MAPS_API_KEY'
    }),
    HttpClientModule,
    MatSnackBarModule
],
declarations: [
    AppComponent,
    AdminLayoutComponent,
],
providers: [
    { provide: KeycloakSecurityService, useValue: securityService },
    { provide: HTTP_INTERCEPTORS, useClass: RequestInterceptorService, multi: true }
],
})

export class AppModule implements DoBootstrap {

ngDoBootstrap(appRef: ApplicationRef): void {
    securityService.init()
    .then(res =&gt; {
        console.log(res);
        appRef.bootstrap(AppComponent);
    })
    .catch((err) =&gt; {
        console.log('Keycloak error ', err);
    });
}
}
</code></pre>

<hr />

<p>Il faut également modifier app.component.ts</p>

<pre><code>import { Component, OnInit} from '@angular/core';
import { KeycloakSecurityService } from './services/keycloak-security.service';


@Component({
selector: 'app-root',
templateUrl: './app.component.html',
styleUrls: ['./app.component.css']
})
export class AppComponent implements OnInit{

title = 'sc-ui';

constructor(public securityService: KeycloakSecurityService){

}

ngOnInit(): void {
    console.log('AppComponent');
}

}
</code></pre>

<hr />

<p>Il faut créer le service RoleGuard qui servira à protéger l&rsquo;accès aux pages</p>

<pre><code>ng g service services/RoleGuard
</code></pre>

<hr />

<pre><code>import { Injectable } from '@angular/core';
import { CanActivate, Router, ActivatedRouteSnapshot } from '@angular/router';
import { KeycloakSecurityService } from './keycloak-security.service';
import { MatSnackBar } from '@angular/material/snack-bar';

@Injectable({
providedIn: 'root'
})
export class RoleGuardService implements CanActivate {

roles = [];

constructor(
    public securityService: KeycloakSecurityService,
    private router: Router,
    private snackBar: MatSnackBar
) {
    this.getAccessRole();
}

canActivate(route: ActivatedRouteSnapshot): boolean {
    const expectedRoleArray = route.data;
    let i = 0;
    while (i &lt; expectedRoleArray.expectedRole.length) {
    let j = 0;
    while (j &lt; this.roles.length) {
        if (expectedRoleArray.expectedRole[i] === this.roles[j]) {
        return true;
        }
        j++;
    }
    i++;
    }
    this.snackBar.open('You are not authorized to access this page.', 'ok', {
    panelClass: 'snackbar-error',
    verticalPosition: 'top',
    duration: 5000,
    });
    this.router.navigate(['/home']);
    return false;
}

private getAccessRole(): void {
    if (this.securityService.kc.hasRealmRole('user')) {
    this.roles.push('user');
    }
    if (this.securityService.kc.hasRealmRole('manager')) {
    this.roles.push('manager');
    }
}
}
</code></pre>

<hr />

<p>Enfin nous allons créer un service qui va centraliser les requêtes vers le serveur back-end</p>

<pre><code>ng g service services/Api
</code></pre>

<hr />

<p>Les méthodes sont très basiques</p>

<pre><code>import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { ApiUrl } from '../utils/api-url';

@Injectable({
providedIn: 'root'
})
export class ApiService {

apiUrl = ApiUrl;

constructor(
    private http: HttpClient,
) { }

public getConnectedUser() {
    return this.http.get(this.apiUrl.GET_CONNECTED_USER)
}

public getUsers(pageNo: number, pageSize: number, sortBy: string) {
    return this.http.get(this.apiUrl.GET_USERS + '?pageNo=' + pageNo + '&amp;pageSize=' + pageSize + '&amp;sortBy=' + sortBy);
}
}
</code></pre>

<hr />

<p>La page Home permettra de rediriger les utilisateurs authentifiés</p>

<pre><code>ng g c Home
</code></pre>

<hr />

<p>Il faut encore modifier quelques fichiers du projet existant</p>

<p>Pour naviguer vers la page <em>Home</em></p>

<p>sidebar.component.ts</p>

<pre><code>import { Component, OnInit } from '@angular/core';
import { KeycloakSecurityService } from 'app/services/keycloak-security.service';

declare const $: any;
declare interface RouteInfo {
    path: string;
    title: string;
    icon: string;
    class: string;
}
export const ROUTES: RouteInfo[] = [
    { path: '/home', title: 'Home',  icon: 'home', class: '' },
    { path: '/dashboard', title: 'Dashboard',  icon: 'dashboard', class: '' },
    { path: '/user-profile', title: 'User Profile',  icon:'person', class: '' },
    { path: '/table-list', title: 'Table List',  icon:'content_paste', class: '' },
    { path: '/typography', title: 'Typography',  icon:'library_books', class: '' },
    { path: '/icons', title: 'Icons',  icon:'bubble_chart', class: '' },
    { path: '/maps', title: 'Maps',  icon:'location_on', class: '' },
    { path: '/notifications', title: 'Notifications',  icon:'notifications', class: '' },
    { path: '/upgrade', title: 'Upgrade to PRO',  icon:'unarchive', class: 'active-pro' },
];

@Component({
selector: 'app-sidebar',
templateUrl: './sidebar.component.html',
styleUrls: ['./sidebar.component.css']
})
export class SidebarComponent implements OnInit {
menuItems: any[];

constructor(public securityService: KeycloakSecurityService) { }

ngOnInit() {
    this.menuItems = ROUTES.filter(menuItem =&gt; menuItem);
}
isMobileMenu() {
    if ($(window).width() &gt; 991) {
        return false;
    }
    return true;
};

}
</code></pre>

<hr />

<p>sidebar.component.ts</p>

<pre><code>&lt;div class=&quot;logo&quot;&gt;
    &lt;a routerLink=&quot;/home&quot; class=&quot;simple-text&quot;&gt;
        &lt;div class=&quot;logo-img&quot;&gt;
            &lt;img src=&quot;/assets/img/angular2-logo-red.png&quot; /&gt;
        &lt;/div&gt;
        Creative Tim
    &lt;/a&gt;
&lt;/div&gt;
&lt;div class=&quot;sidebar-wrapper&quot;&gt;
    &lt;div *ngIf=&quot;isMobileMenu()&quot;&gt;
        &lt;form class=&quot;navbar-form&quot;&gt;
            &lt;span class=&quot;bmd-form-group&quot;&gt;
                &lt;div class=&quot;input-group no-border&quot;&gt;
                    &lt;input type=&quot;text&quot; value=&quot;&quot; class=&quot;form-control&quot; placeholder=&quot;Search...&quot;&gt;
                    &lt;button mat-raised-button type=&quot;submit&quot; class=&quot;btn btn-white btn-round btn-just-icon&quot;&gt;
                        &lt;i class=&quot;material-icons&quot;&gt;search&lt;/i&gt;
                        &lt;div class=&quot;ripple-container&quot;&gt;&lt;/div&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
            &lt;/span&gt;
        &lt;/form&gt;
        &lt;ul class=&quot;nav navbar-nav nav-mobile-menu&quot;&gt;
            &lt;li class=&quot;nav-item&quot;&gt;
                &lt;a class=&quot;nav-link&quot; href=&quot;javascript:void(0)&quot;&gt;
                    &lt;i class=&quot;material-icons&quot;&gt;dashboard&lt;/i&gt;
                    &lt;p&gt;
                        &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;Stats&lt;/span&gt;
                    &lt;/p&gt;
                &lt;/a&gt;
            &lt;/li&gt;
            &lt;li class=&quot;nav-item dropdown&quot;&gt;
                &lt;a class=&quot;nav-link&quot; href=&quot;javascript:void(0)&quot; id=&quot;navbarDropdownMenuLink&quot; data-toggle=&quot;dropdown&quot;
                    aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt;
                    &lt;i class=&quot;material-icons&quot;&gt;notifications&lt;/i&gt;
                    &lt;span class=&quot;notification&quot;&gt;5&lt;/span&gt;
                    &lt;p&gt;
                        &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;Some Actions&lt;/span&gt;
                    &lt;/p&gt;
                &lt;/a&gt;
                &lt;div class=&quot;dropdown-menu dropdown-menu-right&quot; aria-labelledby=&quot;navbarDropdownMenuLink&quot;&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Mike John responded to your email&lt;/a&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;You have 5 new tasks&lt;/a&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;You're now friend with Andrew&lt;/a&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Another Notification&lt;/a&gt;
                    &lt;a class=&quot;dropdown-item&quot; href=&quot;#&quot;&gt;Another One&lt;/a&gt;
                &lt;/div&gt;
            &lt;/li&gt;
            &lt;li class=&quot;nav-item&quot;&gt;
                &lt;a class=&quot;nav-link&quot; href=&quot;javascript:void(0)&quot;&gt;
                    &lt;i class=&quot;material-icons&quot;&gt;person&lt;/i&gt;
                    &lt;p&gt;
                        &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;Account&lt;/span&gt;
                    &lt;/p&gt;
                &lt;/a&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    &lt;ul class=&quot;nav&quot;&gt;
        &lt;li routerLinkActive=&quot;active&quot; *ngFor=&quot;let menuItem of menuItems&quot; class=&quot;{{menuItem.class}} nav-item&quot;&gt;
            &lt;a class=&quot;nav-link&quot; [routerLink]=&quot;[menuItem.path]&quot;
                *ngIf=&quot;!securityService.kc.authenticated &amp;&amp; menuItem.title == 'Home'&quot;&gt;
                &lt;i class=&quot;material-icons&quot;&gt;{{menuItem.icon}}&lt;/i&gt;
                &lt;p&gt;{{menuItem.title}}&lt;/p&gt;
            &lt;/a&gt;
            &lt;a class=&quot;nav-link&quot; [routerLink]=&quot;[menuItem.path]&quot; *ngIf=&quot;securityService.kc.authenticated&quot;&gt;
                &lt;i class=&quot;material-icons&quot;&gt;{{menuItem.icon}}&lt;/i&gt;
                &lt;p&gt;{{menuItem.title}}&lt;/p&gt;
            &lt;/a&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
</code></pre>

<hr />

<p>Quelques méthodes de la librairies de keycloak seront acessible depuis la navbar</p>

<p>navbar.component.ts</p>

<pre><code>import { Component, OnInit, ElementRef } from '@angular/core';
import { ROUTES } from '../sidebar/sidebar.component';
import { Location, LocationStrategy, PathLocationStrategy } from '@angular/common';
import { Router } from '@angular/router';
import { KeycloakSecurityService } from 'app/services/keycloak-security.service';

@Component({
    selector: 'app-navbar',
    templateUrl: './navbar.component.html',
    styleUrls: ['./navbar.component.css']
})
export class NavbarComponent implements OnInit {
    private listTitles: any[];
    location: Location;
    mobile_menu_visible: any = 0;
    private toggleButton: any;
    private sidebarVisible: boolean;

    constructor(
        location: Location,
        private element: ElementRef,
        private router: Router,
        public securityService: KeycloakSecurityService) {
        this.location = location;
        this.sidebarVisible = false;
    }

    ngOnInit() {
        this.listTitles = ROUTES.filter(listTitle =&gt; listTitle);
        const navbar: HTMLElement = this.element.nativeElement;
        this.toggleButton = navbar.getElementsByClassName('navbar-toggler')[0];
        this.router.events.subscribe((event) =&gt; {
            this.sidebarClose();
            var $layer: any = document.getElementsByClassName('close-layer')[0];
            if ($layer) {
                $layer.remove();
                this.mobile_menu_visible = 0;
            }
        });
    }

    sidebarOpen() {
        const toggleButton = this.toggleButton;
        const body = document.getElementsByTagName('body')[0];
        setTimeout(function () {
            toggleButton.classList.add('toggled');
        }, 500);

        body.classList.add('nav-open');

        this.sidebarVisible = true;
    };
    sidebarClose() {
        const body = document.getElementsByTagName('body')[0];
        this.toggleButton.classList.remove('toggled');
        this.sidebarVisible = false;
        body.classList.remove('nav-open');
    };
    sidebarToggle() {
        // const toggleButton = this.toggleButton;
        // const body = document.getElementsByTagName('body')[0];
        var $toggle = document.getElementsByClassName('navbar-toggler')[0];

        if (this.sidebarVisible === false) {
            this.sidebarOpen();
        } else {
            this.sidebarClose();
        }
        const body = document.getElementsByTagName('body')[0];

        if (this.mobile_menu_visible == 1) {
            // $('html').removeClass('nav-open');
            body.classList.remove('nav-open');
            if ($layer) {
                $layer.remove();
            }
            setTimeout(function () {
                $toggle.classList.remove('toggled');
            }, 400);

            this.mobile_menu_visible = 0;
        } else {
            setTimeout(function () {
                $toggle.classList.add('toggled');
            }, 430);

            var $layer = document.createElement('div');
            $layer.setAttribute('class', 'close-layer');


            if (body.querySelectorAll('.main-panel')) {
                document.getElementsByClassName('main-panel')[0].appendChild($layer);
            } else if (body.classList.contains('off-canvas-sidebar')) {
                document.getElementsByClassName('wrapper-full-page')[0].appendChild($layer);
            }

            setTimeout(function () {
                $layer.classList.add('visible');
            }, 100);

            $layer.onclick = function () { //asign a function
                body.classList.remove('nav-open');
                this.mobile_menu_visible = 0;
                $layer.classList.remove('visible');
                setTimeout(function () {
                    $layer.remove();
                    $toggle.classList.remove('toggled');
                }, 400);
            }.bind(this);

            body.classList.add('nav-open');
            this.mobile_menu_visible = 1;

        }
    };

    getTitle() {
        let titlee = this.location.prepareExternalUrl(this.location.path());
        if (titlee.charAt(0) === '#') {
            titlee = titlee.slice(1);
        }

        for (let item = 0; item &lt; this.listTitles.length; item++) {
            if (this.listTitles[item].path === titlee) {
                return this.listTitles[item].title;
            }
        }
        return 'Dashboard';
    }

    onLogin() {
        this.securityService.kc.login();
    }

    onLogout() {
        this.securityService.kc.logout();
    }

    onEditAccount() {
        this.securityService.kc.accountManagement();
    }
}
</code></pre>

<hr />

<p>navbar.component.html</p>

<pre><code>&lt;nav class=&quot;navbar navbar-expand-lg navbar-transparent  navbar-absolute fixed-top&quot;&gt;
    &lt;div class=&quot;container-fluid&quot;&gt;
        &lt;div class=&quot;navbar-wrapper&quot;&gt;
            &lt;a class=&quot;navbar-brand&quot; href=&quot;javascript:void(0)&quot;&gt;{{getTitle()}}&lt;/a&gt;
        &lt;/div&gt;
        &lt;button mat-raised-button class=&quot;navbar-toggler&quot; type=&quot;button&quot; (click)=&quot;sidebarToggle()&quot;&gt;
            &lt;span class=&quot;sr-only&quot;&gt;Toggle navigation&lt;/span&gt;
            &lt;span class=&quot;navbar-toggler-icon icon-bar&quot;&gt;&lt;/span&gt;
            &lt;span class=&quot;navbar-toggler-icon icon-bar&quot;&gt;&lt;/span&gt;
            &lt;span class=&quot;navbar-toggler-icon icon-bar&quot;&gt;&lt;/span&gt;
        &lt;/button&gt;
        &lt;div class=&quot;collapse navbar-collapse justify-content-end&quot; id=&quot;navigation&quot;
            *ngIf=&quot;securityService.kc.authenticated&quot;&gt;
            &lt;form class=&quot;navbar-form&quot;&gt;
                &lt;div class=&quot;input-group no-border&quot;&gt;
                    &lt;input type=&quot;text&quot; value=&quot;&quot; class=&quot;form-control&quot; placeholder=&quot;Search...&quot;&gt;
                    &lt;button mat-raised-button type=&quot;submit&quot; class=&quot;btn btn-white btn-round btn-just-icon&quot;&gt;
                        &lt;i class=&quot;material-icons&quot;&gt;search&lt;/i&gt;
                        &lt;div class=&quot;ripple-container&quot;&gt;&lt;/div&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
            &lt;ul class=&quot;navbar-nav&quot; *ngIf=&quot;securityService.kc.authenticated&quot;&gt;
                &lt;li class=&quot;nav-item dropdown&quot;&gt;
                    &lt;a class=&quot;nav-link&quot; href=&quot;javascript:void(0)&quot; id=&quot;navbarDropdownMenuLink&quot; data-toggle=&quot;dropdown&quot;
                        aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt;
                        &lt;i class=&quot;material-icons&quot;&gt;notifications&lt;/i&gt;
                        &lt;span class=&quot;notification&quot;&gt;5&lt;/span&gt;
                        &lt;p&gt;
                            &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;Some Actions&lt;/span&gt;
                        &lt;/p&gt;
                    &lt;/a&gt;
                    &lt;div class=&quot;dropdown-menu dropdown-menu-right&quot; aria-labelledby=&quot;navbarDropdownMenuLink&quot;&gt;
                        &lt;a class=&quot;dropdown-item&quot; href=&quot;javascript:void(0)&quot;&gt;Mike John responded to your email&lt;/a&gt;
                        &lt;a class=&quot;dropdown-item&quot; href=&quot;javascript:void(0)&quot;&gt;You have 5 new tasks&lt;/a&gt;
                        &lt;a class=&quot;dropdown-item&quot; href=&quot;javascript:void(0)&quot;&gt;You're now friend with Andrew&lt;/a&gt;
                        &lt;a class=&quot;dropdown-item&quot; href=&quot;javascript:void(0)&quot;&gt;Another Notification&lt;/a&gt;
                        &lt;a class=&quot;dropdown-item&quot; href=&quot;javascript:void(0)&quot;&gt;Another One&lt;/a&gt;
                    &lt;/div&gt;
                &lt;/li&gt;
                &lt;li class=&quot;nav-item&quot;&gt;
                    &lt;a class=&quot;clickable nav-link&quot; (click)=&quot;onEditAccount()&quot;&gt;
                        &lt;i class=&quot;material-icons&quot;&gt;person&lt;/i&gt;
                        &lt;p&gt;
                            &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;account&lt;/span&gt;
                        &lt;/p&gt;
                    &lt;/a&gt;
                &lt;/li&gt;
                &lt;li class=&quot;nav-item&quot;&gt;
                    &lt;a class=&quot;clickable nav-link&quot; (click)=&quot;onLogout()&quot;&gt;
                        &lt;i class=&quot;material-icons&quot;&gt;exit_to_app&lt;/i&gt;
                        &lt;p&gt;
                            &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;logout&lt;/span&gt;
                        &lt;/p&gt;
                    &lt;/a&gt;
                &lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
        &lt;div class=&quot;collapse navbar-collapse justify-content-end&quot; id=&quot;navigation&quot;
            *ngIf=&quot;!securityService.kc.authenticated&quot;&gt;
            &lt;ul class=&quot;navbar-nav&quot;&gt;
                &lt;li class=&quot;nav-item&quot;&gt;
                    &lt;a class=&quot;clickable nav-link&quot; (click)=&quot;onLogin()&quot;&gt;
                        &lt;i class=&quot;material-icons&quot;&gt;exit_to_app&lt;/i&gt;
                        &lt;p&gt;
                            &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;login&lt;/span&gt;
                        &lt;/p&gt;
                    &lt;/a&gt;
                &lt;/li&gt;
            &lt;/ul&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/nav&gt;
</code></pre>

<hr />

<p>navbar.component.css</p>

<pre><code>.clickable{
    cursor: pointer
}
</code></pre>

<hr />

<p>Il est important de protéger certaines pages en fonction des rôles de l&rsquo;utilisateur</p>

<p>admin-layout.routing.ts</p>

<pre><code>import { Routes } from '@angular/router';

import { DashboardComponent } from '../../dashboard/dashboard.component';
import { UserProfileComponent } from '../../user-profile/user-profile.component';
import { TableListComponent } from '../../table-list/table-list.component';
import { TypographyComponent } from '../../typography/typography.component';
import { IconsComponent } from '../../icons/icons.component';
import { MapsComponent } from '../../maps/maps.component';
import { NotificationsComponent } from '../../notifications/notifications.component';
import { UpgradeComponent } from '../../upgrade/upgrade.component';
import { RoleGuardService } from 'app/services/role-guard.service';
import { HomeComponent } from 'app/home/home.component';

export const AdminLayoutRoutes: Routes = [
    {
        path: 'home',
        component: HomeComponent
    },
    {
        path: 'dashboard',
        component: DashboardComponent,
        canActivate: [RoleGuardService],
        data: {
            expectedRole: ['user', 'manager']
        }
    },
    {
        path: 'user-profile',
        component: UserProfileComponent,
        canActivate: [RoleGuardService],
        data: {
            expectedRole: ['user', 'manager']
        }
    },
    {
        path: 'table-list',
        component: TableListComponent,
        canActivate: [RoleGuardService],
        data: {
            expectedRole: ['manager']
        }
    },
    {
        path: 'typography',
        component: TypographyComponent,
        canActivate: [RoleGuardService],
        data: {
            expectedRole: ['user', 'manager']
        }
    },
    {
        path: 'icons',
        component: IconsComponent,
        canActivate: [RoleGuardService],
        data: {
            expectedRole: ['user', 'manager']
        }
    },
    {
        path: 'maps',
        component: MapsComponent,
        canActivate: [RoleGuardService],
        data: {
            expectedRole: ['user', 'manager']
        }
    },
    {
        path: 'notifications',
        component: NotificationsComponent,
        canActivate: [RoleGuardService],
        data: {
            expectedRole: ['user', 'manager']
        }
    },
    {
        path: 'upgrade',
        component: UpgradeComponent,
        canActivate: [RoleGuardService],
        data: {
            expectedRole: ['user', 'manager']
        }
    },
];
</code></pre>

<hr />

<p>admin-layout.module.ts</p>

<pre><code>import { NgModule } from '@angular/core';
import { RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { AdminLayoutRoutes } from './admin-layout.routing';
import { DashboardComponent } from '../../dashboard/dashboard.component';
import { UserProfileComponent } from '../../user-profile/user-profile.component';
import { TableListComponent } from '../../table-list/table-list.component';
import { TypographyComponent } from '../../typography/typography.component';
import { IconsComponent } from '../../icons/icons.component';
import { MapsComponent } from '../../maps/maps.component';
import { NotificationsComponent } from '../../notifications/notifications.component';
import { UpgradeComponent } from '../../upgrade/upgrade.component';
import {MatButtonModule} from '@angular/material/button';
import {MatInputModule} from '@angular/material/input';
import {MatRippleModule} from '@angular/material/core';
import {MatFormFieldModule} from '@angular/material/form-field';
import {MatTooltipModule} from '@angular/material/tooltip';
import {MatSelectModule} from '@angular/material/select';
import { HomeComponent } from 'app/home/home.component';

@NgModule({
imports: [
    CommonModule,
    RouterModule.forChild(AdminLayoutRoutes),
    FormsModule,
    ReactiveFormsModule,
    MatButtonModule,
    MatRippleModule,
    MatFormFieldModule,
    MatInputModule,
    MatSelectModule,
    MatTooltipModule,
],
declarations: [
    HomeComponent,
    DashboardComponent,
    UserProfileComponent,
    TableListComponent,
    TypographyComponent,
    IconsComponent,
    MapsComponent,
    NotificationsComponent,
    UpgradeComponent,
]
})

export class AdminLayoutModule {}
</code></pre>

<hr />

<h3 id="affichage-personnalisée">Affichage personnalisée</h3>

<p>Une amélioration de la page UserProfile</p>

<p>user-profile.component.ts</p>

<pre><code>import { Component, OnInit } from '@angular/core';
import { ApiService } from 'app/services/api.service';

@Component({
selector: 'app-user-profile',
templateUrl: './user-profile.component.html',
styleUrls: ['./user-profile.component.css']
})
export class UserProfileComponent implements OnInit {

user: any;
public errorMessage: any;

constructor(private apiService: ApiService) { }

ngOnInit() {
    this.apiService.getConnectedUser()
    .subscribe(data =&gt; {
    this.user = data;
    }, err =&gt; {
    console.log('err.error.message : ' + err.error.message);
    this.errorMessage = err.error.message;
    });
}

}
</code></pre>

<hr />

<p>user-profile.component.html</p>

<pre><code>&lt;div class=&quot;main-content&quot;&gt;
&lt;div class=&quot;container-fluid&quot;&gt;
    &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col-md-8&quot;&gt;
        &lt;div class=&quot;card&quot;&gt;
        &lt;div class=&quot;card-header card-header-danger&quot;&gt;
            &lt;h4 class=&quot;card-title&quot;&gt;Your Profile&lt;/h4&gt;
            &lt;p class=&quot;card-category&quot;&gt;data from keycloak&lt;/p&gt;
        &lt;/div&gt;
        &lt;div class=&quot;card-body&quot;&gt;
            &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-3&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                Username
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-md-9&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                {{user?.username}}
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-3&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                email
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-md-9&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                {{user?.email}}
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-3&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                firstName
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-md-9&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                {{user?.firstName}}
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-3&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                lastName
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-md-9&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                {{user?.lastName}}
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-3&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                space
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-md-9&quot;&gt;
                &lt;mat-form-field class=&quot;example-full-width&quot;&gt;
                {{user?.space?.name}}
                &lt;/mat-form-field&gt;
            &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-md-4&quot;&gt;
        &lt;div class=&quot;card card-profile&quot;&gt;
        &lt;div class=&quot;card-avatar&quot;&gt;
            &lt;a href=&quot;javascript:void(0)&quot;&gt;
            &lt;img class=&quot;img&quot; src=&quot;./assets/img/faces/marc.jpg&quot; /&gt;
            &lt;/a&gt;
        &lt;/div&gt;
        &lt;div class=&quot;card-body&quot;&gt;
            &lt;h6 class=&quot;card-category text-gray&quot;&gt;CEO / Co-Founder&lt;/h6&gt;
            &lt;h4 class=&quot;card-title&quot;&gt;Alec Thompson&lt;/h4&gt;
            &lt;p class=&quot;card-description&quot;&gt;
            Don't be scared of the truth because we need to restart the human foundation in truth And I love you like
            Kanye loves Kanye I love Rick Owens’ bed design but the back is...
            &lt;/p&gt;
            &lt;a href=&quot;javascript:void(0)&quot; class=&quot;btn btn-danger btn-round&quot;&gt;Follow&lt;/a&gt;
        &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</code></pre>

<hr />

<p>Enfin une récupération de tous les utilisateurs du back-end avec une pagination customisée</p>

<p>table-list.component.ts</p>

<pre><code>import { Component, OnInit } from '@angular/core';
import { ApiService } from 'app/services/api.service';

@Component({
selector: 'app-table-list',
templateUrl: './table-list.component.html',
styleUrls: ['./table-list.component.css']
})
export class TableListComponent implements OnInit {

users: any;
public errorMessage: any;
pageNo: number;
pageSize: number;
sortBy;

constructor(private apiService: ApiService) { }

ngOnInit() {
    this.pageNo = 0;
    this.pageSize = 10;
    this.sortBy = 'id';
    this.getUsers(this.pageNo, this.sortBy);
}

getUsers(pageNo: number, sortBy: string) {
    this.apiService.getUsers(pageNo, this.pageSize, this.sortBy)
    .subscribe(data =&gt; {
        this.users = data;
        this.cancelNext(this.users.length);
    }, err =&gt; {
        console.log('err.error.message : ' + err.error.message);
        this.errorMessage = err.error.message;
    });
}

navigateBefore() {
    if (this.pageNo !== 0) {
    this.pageNo -= 1;
    this.getUsers(this.pageNo, this.sortBy);
    }
}

navigateNext() {
    this.pageNo += 1;
    this.getUsers(this.pageNo, this.sortBy);
}

cancelNext(size: number) {
    console.log('size : ' + + size);
    if (size === 0) {
    this.pageNo -= 1;
    this.getUsers(this.pageNo, this.sortBy);
    }
}

sortById() {
    this.sortBy = 'id';
    this.getUsers(this.pageNo, this.sortBy);
}

sortByGender() {
    this.sortBy = 'gender';
    this.getUsers(this.pageNo, this.sortBy);
}

sortByUsername() {
    this.sortBy = 'username';
    this.getUsers(this.pageNo, this.sortBy);
}

sortByFirstName() {
    this.sortBy = 'firstName';
    this.getUsers(this.pageNo, this.sortBy);
}

sortByLastName() {
    this.sortBy = 'lastName';
    this.getUsers(this.pageNo, this.sortBy);
}

sortByEmail() {
    this.sortBy = 'email';
    this.getUsers(this.pageNo, this.sortBy);
}

sortByStatus() {
    this.sortBy = 'status';
    this.getUsers(this.pageNo, this.sortBy);
}

}
</code></pre>

<hr />

<p>table-list.component.html</p>

<pre><code>&lt;div class=&quot;main-content&quot;&gt;
    &lt;div class=&quot;container-fluid&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-12&quot;&gt;
                &lt;div class=&quot;card card-plain&quot;&gt;
                    &lt;div class=&quot;card-header card-header-danger&quot;&gt;
                        &lt;h4 class=&quot;card-title mt-0&quot;&gt; Table on Plain Background&lt;/h4&gt;
                        &lt;p class=&quot;card-category&quot;&gt; Here is a subtitle for this table&lt;/p&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;card-body&quot;&gt;
                        &lt;div class=&quot;table-responsive&quot;&gt;
                            &lt;table class=&quot;table table-hover&quot;&gt;
                                &lt;thead class=&quot;&quot;&gt;
                                    &lt;th&gt;
                                        &lt;a (click)=&quot;sortById()&quot;&gt;Id&lt;/a&gt;
                                    &lt;/th&gt;
                                    &lt;th&gt;
                                        &lt;a (click)=&quot;sortByGender()&quot;&gt;Gender&lt;/a&gt;
                                    &lt;/th&gt;
                                    &lt;th&gt;
                                        &lt;a (click)=&quot;sortByUsername()&quot;&gt;Username&lt;/a&gt;
                                    &lt;/th&gt;
                                    &lt;th&gt;
                                        &lt;a (click)=&quot;sortByFirstName()&quot;&gt;First Name&lt;/a&gt;
                                    &lt;/th&gt;
                                    &lt;th&gt;
                                        &lt;a (click)=&quot;sortByLastName()&quot;&gt;Last Name&lt;/a&gt;
                                    &lt;/th&gt;
                                    &lt;th&gt;
                                        &lt;a (click)=&quot;sortByEmail()&quot;&gt;Email&lt;/a&gt;
                                    &lt;/th&gt;
                                    &lt;th&gt;
                                        &lt;a (click)=&quot;sortByStatus()&quot;&gt;Status&lt;/a&gt;
                                    &lt;/th&gt;
                                    &lt;th&gt;
                                        Space
                                    &lt;/th&gt;
                                &lt;/thead&gt;
                                &lt;tbody&gt;
                                    &lt;tr *ngFor=&quot;let user of users&quot;&gt;
                                        &lt;td&gt;
                                            {{user.id}}
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            {{user.gender}}
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            {{user.username}}
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            {{user.firstName}}
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            {{user.lastName}}
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            {{user.email}}
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            {{user.status}}
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            {{user.space.name}}
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                    &lt;tr&gt;
                                        &lt;td&gt;
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            &lt;a class=&quot;clickable nav-link&quot; (click)=&quot;navigateBefore()&quot;&gt;
                                                &lt;i class=&quot;material-icons&quot;&gt;navigate_before&lt;/i&gt;
                                                &lt;p&gt;
                                                    &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;Before&lt;/span&gt;
                                                &lt;/p&gt;
                                            &lt;/a&gt;
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            &lt;a class=&quot;clickable nav-link&quot; (click)=&quot;navigateNext()&quot;&gt;
                                                &lt;i class=&quot;material-icons&quot;&gt;navigate_next&lt;/i&gt;
                                                &lt;p&gt;
                                                    &lt;span class=&quot;d-lg-none d-md-block&quot;&gt;Next&lt;/span&gt;
                                                &lt;/p&gt;
                                            &lt;/a&gt;
                                        &lt;/td&gt;
                                    &lt;/tr&gt;
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>Vous pouvez maintenant lancer l&rsquo;application en mode local</p>

<pre><code>ng serve --open
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>Vous disposer d&rsquo;une application en micro service comprenant un serveur d&rsquo;authentification, d&rsquo;un back-end en java et d&rsquo;un Front-end avec Angular. L&rsquo;application est protégé de manière optimale avec un token de session jwt. Tout est géré par Keycloak. L&rsquo;implémentation est relativement simple. Dans la rubrique Gitlab vous verrez comment tester et déployer le projet back-end. Je compte si le temps me le permet de faire de l&rsquo;intégration et du déploiment continue avec le front-end sous docker.</p>

<p>PS: Cet article a été écrit relativement vite, ne vous offusquez pas des fautes d&rsquo;orthographes ou erreurs de syntaxes. Je compte l&rsquo;améliorer au fur et à mesure!</p>

				</section>
			</article>
		</main>
	</div> 

	

<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div id="sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4 class="sidebar-heading">Table of Contents</h4>
			<ul>
				<li><strong><a href="#title">Keycloak</a></strong></li>
			</ul>
			<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#vidéos-de-m-mohamed-youssfi">Vidéos de M. Mohamed Youssfi</a></li>
<li><a href="#dépôts-gitlab">Dépôts Gitlab</a></li>
<li><a href="#projet-spécificités-techniques">Projet : spécificités techniques</a></li>
<li><a href="#projet-spécificités-fonctionnelles">Projet : spécificités fonctionnelles</a></li>
</ul></li>
<li><a href="#serveur-d-authentification-100-portable-avec-docker">Serveur d&rsquo;authentification 100 % portable avec docker</a>
<ul>
<li><a href="#déploiement-de-keycloak-dans-une-vm-gcp">Déploiement de Keycloak dans une VM GCP</a></li>
<li><a href="#l-ihm-de-keycloak">L&rsquo;IHM de Keycloak</a></li>
</ul></li>
<li><a href="#back-end-en-java-avec-springboot">Back-end en java avec Springboot</a>
<ul>
<li><a href="#déploiement-du-back-end-et-serveur-keycloak-100-sur-son-local">Déploiement du Back-end et serveur Keycloak 100% sur son local</a></li>
<li><a href="#les-profils-maven-et-springboot">Les profils maven et Springboot</a></li>
<li><a href="#les-tests-unitaires">Les tests unitaires</a></li>
<li><a href="#les-tests-d-intégration">Les tests d&rsquo;intégration</a></li>
</ul></li>
<li><a href="#le-front-end-avec-angular-material">Le front-end avec Angular Material</a>
<ul>
<li><a href="#le-projet-et-ses-dépendances">Le projet et ses dépendances</a></li>
<li><a href="#les-variables-d-environnement">Les variables d&rsquo;environnement</a></li>
<li><a href="#implémentation-de-keycloak">Implémentation de keycloak</a></li>
<li><a href="#affichage-personnalisée">Affichage personnalisée</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</nav>
		</div>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Pages in Categories</h4>
		<ul class="sidebar-category-list">
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/1/spring-security">
					<span class="doc-list-category">1/Spring-Security</span>
				</a>
				<ul>
					<li><a href="/blog/articles/spring-security/">Spring Security</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/2/springboot-tests">
					<span class="doc-list-category">2/Springboot-Tests</span>
				</a>
				<ul>
					<li><a href="/blog/articles/springboot-tests/">Springboot-tests</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/3/keycloak">
					<span class="doc-list-category">3/Keycloak</span>
				</a>
				<ul>
					<li>
						<span class="active">Keycloak</span>
						</li>
				
				</ul>
			</li>
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/4/gitlab-ci-cd">
					<span class="doc-list-category">4/Gitlab-Ci-Cd</span>
				</a>
				<ul>
					<li><a href="/blog/articles/gitlab-ci-cd/">Gitlab Ci Cd</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/5/jms-websocket">
					<span class="doc-list-category">5/Jms-Websocket</span>
				</a>
				<ul>
					<li><a href="/blog/articles/jms-websocket/">Jms Websocket</a>
					</li>
				
				</ul>
			</li>
		
		</ul>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Tags</h4>
		<div class="tag-box">
		
			<a class="tag-item" href="https://jeannory.github.io/blog/tags/1/spring-security">1/spring-security</a>
		
			<a class="tag-item" href="https://jeannory.github.io/blog/tags/2/springboot-tests">2/springboot-tests</a>
		
			<a class="tag-item" href="https://jeannory.github.io/blog/tags/3/keycloak">3/keycloak</a>
		
			<a class="tag-item" href="https://jeannory.github.io/blog/tags/4/gitlab-ci-cd">4/gitlab-ci-cd</a>
		
			<a class="tag-item" href="https://jeannory.github.io/blog/tags/5/jms-websocket">5/jms-websocket</a>
		
			<a class="tag-item" href="https://jeannory.github.io/blog/tags/author">author</a>
		
		</div>
	</div>
	</div>
</div>

</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		<p class="doc-footer-em"><a href="#" onclick="resetSidebarPos()">Back to TOP</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	
	
	<p>Powered by <strong><a href="https://github.com/progrhyme/hugo-theme-bootie-docs">Bootie Docs</a></strong> - theme for <a href="http://gohugo.io/">Hugo</a> by <a href="https://github.com/progrhyme/">progrhyme</a>.</p>
</footer>



<script src="https://jeannory.github.io/blog/js/jquery.min.js"></script>
<script src="https://jeannory.github.io/blog/js/bootstrap.min.js"></script>

<script src="https://jeannory.github.io/blog/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="https://jeannory.github.io/blog/js/ie10-viewport-bug-workaround.js"></script>
<script src="https://jeannory.github.io/blog/js/bootie-docs.js"></script>

</body>
</html>
