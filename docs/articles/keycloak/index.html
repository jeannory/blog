<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Jeannory&#39;s blog">
		<link rel="icon" href="https://jeannory.github.io/blog/favicon.ico">
		<title>Keycloak - Jeannory&#39;s blog</title>
		
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/highlight/default.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/theme.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/bootie-docs.css">
		<link rel="stylesheet" href="https://jeannory.github.io/blog/css/site.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="https://jeannory.github.io/blog/">Jeannory&#39;s blog</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li ><a href="https://jeannory.github.io/blog/author">Author</a></li>
			
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Categories<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="https://jeannory.github.io/blog/categories/gitlab">Gitlab</a></li>
						
							<li><a href="https://jeannory.github.io/blog/categories/keycloak">Keycloak</a></li>
						
							<li><a href="https://jeannory.github.io/blog/categories/spring-security">Spring-Security</a></li>
						
							<li><a href="https://jeannory.github.io/blog/categories/springboot-tests">Springboot-Tests</a></li>
						
						</ul>
					</li>
				
				</ul>
				
			</div>
		</div>
	</nav>

<div class="container">


<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">Keycloak</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2020-04-23">April 23, 2020</time></span>
				</div>
				<section>
					

<h2 id="introduction">Introduction</h2>

<p><em>MAJ au 16/07/2020 reprise de cet article après une courte pause de 3 mois :)</em></p>

<p>Keycloak est serveur d&rsquo;authentification standalone.
Il est reconnu pour la protection qu&rsquo;il propose en termes de cyber sécurité et aussi par les très nombreuses librairies/fonctionnalités qui permettent une utilisation étendue (Java, AngularJs, Typescript, Ldap, etc..). Beaucoup d&rsquo;entreprises lui font confiance et lui délèguent la partie authentification/autorisation.
C&rsquo;est un projet open source codé en java, qui fait preuve d&rsquo;une grande maturité (version 9 à ce jour).</p>

<p>Mohamed Youssfi formateur java explique comment sécuriser des applications en micro-service avec Keycloak à travers 11 vidéos.</p>

<!-- <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/watch?v=2DYWyE9jkEY" style="position: absolute; top: 0; left: 0; width: 50%; height: 75%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div> -->

<h3 id="vidéos-de-m-mohamed-youssfi">Vidéos de M. Mohamed Youssfi</h3>

<p>Sécuriser des applications en micro-service avec Keycloak.</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=2DYWyE9jkEY">Part 1 - Basic Concepts</a></li>
<li><a href="https://www.youtube.com/watch?v=hiu4uHjdWbY&amp;t=35s">Part 2 - Distributed App Use Case</a></li>
<li><a href="https://www.youtube.com/watch?v=mFJSxX9d-Cg">Part 3 - Getting Started with Keycloak</a></li>
<li><a href="https://www.youtube.com/watch?v=QksFYgRUxGQ&amp;t=188s">Part 4 - Spring MVC Application</a></li>
<li><a href="https://www.youtube.com/watch?v=NvpbR_wvPlQ&amp;t=6s">Part 5 - Spring Security Keycloak Adapter</a></li>
<li><a href="https://www.youtube.com/watch?v=grvDI2kvgsc&amp;t=4s">Part 6 - Micro-Service Rest API Bearer Only case</a></li>
<li><a href="https://www.youtube.com/watch?v=Seq2qCCwxZ0&amp;t=37s">Part 7 - Angular Application to Secure</a></li>
<li><a href="https://www.youtube.com/watch?v=5n0DhOdLxPc&amp;t=29s">Part 8 - Keycloak js in Angular App</a></li>
<li><a href="https://www.youtube.com/watch?v=nIm78BIIeFE&amp;t=27s">Part 9 - Http Authorization Header Interceptor</a></li>
<li><a href="https://www.youtube.com/watch?v=ObHhIvSILOs&amp;t=21s">Part 10 - Back to some improvements</a></li>
<li><a href="https://www.youtube.com/watch?v=13vIJR8vT3w&amp;t=110s">Part 11 - Other Concepts Themes</a></li>
</ul>

<hr />

<p>Exemple d&rsquo;implémentation, avec des tests et une application entièrement portable grâce aux containers.</p>

<h3 id="dépôts-gitlab">Dépôts Gitlab</h3>

<ul>
<li><a href="https://gitlab.com/phou.jeannory/keycloak-back-end.git">Back-end</a></li>
<li><a href="https://gitlab.com/phou.jeannory/keycloak-front-end.git">Front-end</a></li>
</ul>

<hr />

<h3 id="projet-spécificités-techniques">Projet : spécificités techniques</h3>

<ul>
<li>Serveur d&rsquo;authentification</li>
<li>Back-end en java avec Springboot</li>
<li>Front-end en Angular Material</li>
<li>Docker de la base de données Postgresql</li>
<li>Docker du serveur keycloak</li>
<li>Docker de la base de données Mysql de keycloak</li>
<li>Tests unitaires</li>
<li>Tests d&rsquo;intégration</li>
</ul>

<h3 id="projet-spécificités-fonctionnelles">Projet : spécificités fonctionnelles</h3>

<ul>
<li>L&rsquo;utilisateur peut se connecter/déconnecter</li>
<li>L&rsquo;utilisateur peut créer un compte</li>
<li>L&rsquo;utilisateur peut accéder/modifier son profil</li>
<li>L&rsquo;utilisateur disposant du rôle manager peut accéder à la liste de tous les utilisateurs</li>
</ul>

<hr />

<h3 id="serveur-d-authentification-100-portable-avec-docker">Serveur d&rsquo;authentification 100 % portable avec docker</h3>

<p>Dans une application en micro service, le serveur d&rsquo;authentification est décorélé des autres micro services. Le serveur Keycloak est déployé dans une VM.
Keycloak et ses dépendances sont buildés dans une même image docker. Ils sont donc portable d&rsquo;un environnement à un autre.
Cette image comporte le serveur standalone de Keycloak, et sa base de données MySql (répertoire dev-docker-integration-keycloak):</p>

<p>docker-compose.yml</p>

<pre><code>version: '3.1'
services:
    lab-mysql:
        container_name: mysql-dev-docker
        restart: always
        image: mysql/mysql-server
        environment:
            MYSQL_ROOT_PASSWORD: password
            MYSQL_ROOT_HOST: &quot;%&quot;
            MYSQL_DATABASE: keycloak
            MYSQL_USER: keycloak
            MYSQL_PASSWORD: password
        volumes:
            - ./../target/mysql-dev-docker:/var/lib/mysql
        ports:
            - 3306:3306
    keycloak:
        container_name: keycloak-dev-docker
        restart: always
        image: jboss/keycloak
        depends_on:
            - lab-mysql
        environment:
            DB_VENDOR: MYSQL
            DB_ADDR: lab-mysql
            DB_PORT: 3306
            DB_DATABASE: keycloak
            DB_USER: keycloak
            DB_PASSWORD: password
            KEYCLOAK_USER: admin
            KEYCLOAK_PASSWORD: 1234
        ports:
            - 8099:8080
            - 8443:8443
            - 9990:9990
        volumes:
            - ./../target/keycloak-dev-docker:/data
        links:
            - lab-mysql
</code></pre>

<hr />

<h3 id="déploiement-de-keycloak-dans-une-vm-gcp">Déploiement de Keycloak dans une VM GCP</h3>

<p>Il s&rsquo;agit d&rsquo;une petite VM sous Ubuntu Serveur (g1-small :1 vCPU, 1,7 Go de mémoire).
Il faut déployer l&rsquo;image et restaurer la base de données:</p>

<pre><code>docker-compose -f docker-compose.yml up -d
</code></pre>

<hr />

<p>Si nécessaire, récupérer l&rsquo;ip de l&rsquo;image mysql-dev-docker.</p>

<pre><code>docker inspect mysql-dev-docker
</code></pre>

<hr />

<pre><code>&quot;NetworkID&quot;: &quot;909b56f4c2caa1c594f8d691e0204cc236849fb25ddb2302bb75fcba516a8698&quot;,
&quot;EndpointID&quot;: &quot;21d1c92defc16198b971ecf87be244bcff13c3e8bb5750753c8d2c428a85685e&quot;,
&quot;Gateway&quot;: &quot;172.25.0.1&quot;,
&quot;IPAddress&quot;: &quot;172.25.0.3&quot;,
</code></pre>

<hr />

<p>Restaurer la base de données Mysql.</p>

<pre><code>cd keycloak-config
cat backup.sql | docker exec -i mysql-dev-docker /usr/bin/mysql -h '172.25.0.3' -u keycloak -ppassword keycloak
</code></pre>

<p>ou</p>

<pre><code>cd keycloak-config
cat backup.sql | docker exec -i mysql-dev-docker /usr/bin/mysql -u keycloak -ppassword keycloak
</code></pre>

<p><em>Cette configuration a un niveau de sécurité permettant l&rsquo;exposition de l&rsquo;Ihm avec le protocol http.</em></p>

<hr />

<h3 id="l-ihm-de-keycloak">L&rsquo;IHM de Keycloak</h3>

<p>Assurez-vous que le port de la VM soit ouverte en entré sur le port définis pour keycloak (8089)
Se connecter à l&rsquo;IHM :</p>

<pre><code>http://35.209.231.158:8099/auth/
</code></pre>

<p>Les crédentials figurent sur le docker-compose.yml</p>

<pre><code>KEYCLOAK_USER: admin
KEYCLOAK_PASSWORD: 1234
</code></pre>

<hr />

<p><img src="/blog/img/gitlab-15.png" alt="keycloak-realm" /></p>

<p>Le Realm correspond au royaume ou à l&rsquo;entretprise.</p>

<hr />

<p><img src="/blog/img/gitlab-16.png" alt="keycloak-clients" /></p>

<p>Les clients sont les applications de l&rsquo;entreprise. Dans notre exemple il y a 2 clients qui vont être utilisés:</p>

<ul>
<li>sc-ui (Front-end)</li>
<li>sc-user (Back-end)</li>
</ul>

<hr />

<p><img src="/blog/img/gitlab-17.png" alt="keycloak-roles" /></p>

<p>Les rôles peuvent être définis de manière globale ou pour une ou plusieurs applications (clients).</p>

<hr />

<p><img src="/blog/img/gitlab-18.png" alt="keycloak-users" /></p>

<p>Les utilisateurs sont visibles dans l&rsquo;IHM. Leurs rôles peuvent ainsi être définis.</p>

<hr />

<p><img src="/blog/img/gitlab-19.png" alt="keycloak-installations" /></p>

<p>Ces éléments vont être utiles pour créer les connecteurs des applications</p>

<hr />

<h2 id="back-end-en-java-avec-springboot">Back-end en java avec Springboot</h2>

<p>Les infos récupérés vont servir à renseigner le fichier de configuration de Springboot.</p>

<pre><code>{
&quot;realm&quot;: &quot;Sc-project&quot;,
&quot;auth-server-url&quot;: &quot;http://35.209.231.158:8099/auth/&quot;,
&quot;ssl-required&quot;: &quot;none&quot;,
&quot;resource&quot;: &quot;sc-user&quot;,
&quot;public-client&quot;: true,
&quot;confidential-port&quot;: 0
}
</code></pre>

<p>Le nom de domaine <a href="http://jeannory.ovh">http://jeannory.ovh</a> pointe bien évidement vers l&rsquo;ip externe <a href="http://35.209.231.158">http://35.209.231.158</a></p>

<p>Le profil dev-docker-integration va servir pour les étapes de CI/CD. Gitlab va se connecter à cette VM afin de réaliser tous les tests d&rsquo;intégration.</p>

<pre><code>---

spring:
profiles: dev-docker-integration

jpa:
    database: POSTGRESQL
    show-sql: true
    hibernate:
    ddl-auto: create-drop

datasource:
    platform: postgres
    url: jdbc:postgresql://jeannory.dynamic-dns.net:5432/keycloak_back_end_db
    username: user1
    password: 1234!*MyJea@99
    driverClassName: org.postgresql.Driver
    initialization-mode: always

keycloak:
realm: Sc-project
auth-server-url: http://jeannory.ovh:8099/auth/
resource: sc-user
public-client: false
bearer-only: true
cors: true


sc-properties:
authServerUrl: http://jeannory.ovh:8099/auth/
authServerParameters: realms/Sc-project/protocol/openid-connect/token

---
</code></pre>

<hr />

<p>La redéfinition de la méthode <em>configure</em> permet une protection des end-points en fonction des rôles</p>

<pre><code>@KeycloakConfiguration
public class KeycloakSpringSecurityConfig extends KeycloakWebSecurityConfigurerAdapter {

    @Override
    protected SessionAuthenticationStrategy sessionAuthenticationStrategy() {
        return new RegisterSessionAuthenticationStrategy(new SessionRegistryImpl());
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception{
        auth.authenticationProvider(new KeycloakAuthenticationProvider());
    }

    @Override
    protected void configure(HttpSecurity http)throws Exception{
        super.configure(http);
        http.authorizeRequests().antMatchers(&quot;/api/users/connected-user&quot;).hasAuthority((&quot;user&quot;));
        http.authorizeRequests().antMatchers(&quot;/api/users&quot;).hasAuthority((&quot;manager&quot;));
        http.authorizeRequests().antMatchers(&quot;/api/spaces/**&quot;).hasAuthority((&quot;manager&quot;));
    }

}
</code></pre>

<hr />

<p>Ces méthodes permettent de récupérer les infos de l&rsquo;utilisateurs dans le security context de l&rsquo;application.</p>

<pre><code>@Component
public class KeycloakSecurityContext {

    /**
    *
    * @return roles
    */
    public OidcKeycloakAccount getOidcKeycloakAccount(){
        return getKeycloakAuthenticationToken().getAccount();
    }

    /**
    *
    * @return preferredUsername, email, givenName, familyName
    */
    public AccessToken getAccessToken(){
        return getOidcKeycloakAccount().getKeycloakSecurityContext().getToken();
    }

    @Bean
    @Scope(scopeName = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
    private KeycloakAuthenticationToken getKeycloakAuthenticationToken(){
        return (KeycloakAuthenticationToken) ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest().getUserPrincipal();
    }

}
</code></pre>

<hr />

<p>La méthode getAccessToken() permet ainsi de récupérer le username (accessToken.getPreferredUsername()), pour s&rsquo;en servir par la suite.</p>

<pre><code>@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private KeycloakSecurityContext keycloakSecurityContext;

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private SpaceRepository spaceRepository;

    @Autowired
    @Qualifier(&quot;UserUserDtoConverter&quot;)
    private SuperConverter&lt;User, UserDto&gt; converter;

    @Override
    public UserDto getConnectedUserDto() {
        try {
            return converter.toDto(getConnectedUser());
        } catch (CustomServiceException ex) {
            return null;
        }
    }

    @Override
    public List&lt;UserDto&gt; getAllUsers(final Integer pageNo, final Integer pageSize, final String sortBy) {
        final Pageable paging = PageRequest.of(pageNo, pageSize, Sort.by(sortBy));
        final Page&lt;User&gt; pagedResult = userRepository.findAll(paging);
        if(pagedResult.hasContent()) {
            return converter.toDtos(pagedResult.getContent());
        } else {
            return new ArrayList&lt;&gt;();
        }
    }



    //catch CustomTransactionalException in this method
    private User getConnectedUser() {
        final AccessToken accessToken = keycloakSecurityContext.getAccessToken();
        if (accessToken == null) {
            throw new CustomServiceException(&quot;error getAccessToken failed&quot;);
        } else if (accessToken.getPreferredUsername() == null || accessToken.getPreferredUsername().isEmpty()) {
            throw new CustomServiceException(&quot;error preferredUsername cannot be null or empty&quot;);
        }
        final String username = accessToken.getPreferredUsername();
        User user = userRepository.findByUsernameIgnoreCase(username);
        if (user == null) {
            try {
                user = testCreateUser(accessToken);
            } catch (CustomTransactionalException ex) {
                return null;
            }
        }
        return user;
    }

    // Do not catch CustomTransactionalException in this method
    @Transactional(propagation = Propagation.REQUIRES_NEW,
            rollbackFor = CustomTransactionalException.class)
    private User testCreateUser(final AccessToken accessToken) {
        return validateCreateUser(accessToken);
    }

    // MANDATORY: Transaction must be created before.
    @Transactional(propagation = Propagation.MANDATORY)
    private User validateCreateUser(final AccessToken accessToken) {
        try {
            final Space space = new Space(null, accessToken.getPreferredUsername() + &quot;_space&quot;, null);
            spaceRepository.save(space);
            final User user = new User();
            user.setUsername(accessToken.getPreferredUsername());
            user.setEmail(accessToken.getEmail());
            user.setFirstName(accessToken.getGivenName());
            user.setLastName(accessToken.getFamilyName());
            user.setSpace(space);
            userRepository.save(user);
            return userRepository.findByUsernameIgnoreCase(accessToken.getPreferredUsername());
        } catch (Exception ex) {
            throw new CustomTransactionalException(&quot;persistence failed : &quot; + ex.getMessage());
        }
    }

}
</code></pre>

<hr />

<p>Ces quelques classes/fichier de configuation permettent une très rapide implémentation d&rsquo;un projet back-end avec une sécurisation optimale.</p>

<h3 id="déploiement-du-back-end-et-serveur-keycloak-100-sur-son-local">Déploiement du Back-end et serveur Keycloak 100% sur son local</h3>

<p>Build les images de Postgresql, Keycloak et sa bdd MySql (répertoire dev-docker).</p>

<pre><code>cd dev-docker
docker-compose -f docker-compose.yml up -d
</code></pre>

<p>docker-compose.yml.</p>

<pre><code>version: '3.1'
services:
    db:
        image: postgres
        container_name: postgresql-dev-docker
        restart: always
        environment:
            POSTGRES_DB: keycloak_back_end_db
            POSTGRES_PASSWORD: 1234!*MyJea@99
            POSTGRES_USER: user1
        volumes:
            - ./../target/postgresql-dev-docker:/var/lib/postgresql/data
        ports:
            - 5432:5432
    lab-mysql:
        container_name: mysql-dev-docker
        restart: always
        image: mysql/mysql-server
        environment:
            MYSQL_ROOT_PASSWORD: password
            MYSQL_ROOT_HOST: &quot;%&quot;
            MYSQL_DATABASE: keycloak
            MYSQL_USER: keycloak
            MYSQL_PASSWORD: password
        volumes:
            - ./../target/mysql-dev-docker:/var/lib/mysql
        ports:
            - 3306:3306
    keycloak:
        container_name: keycloak-dev-docker
        restart: always
        image: jboss/keycloak
        depends_on:
            - lab-mysql
        environment:
            DB_VENDOR: MYSQL
            DB_ADDR: lab-mysql
            DB_PORT: 3306
            DB_DATABASE: keycloak
            DB_USER: keycloak
            DB_PASSWORD: password
            KEYCLOAK_USER: admin
            KEYCLOAK_PASSWORD: 1234
        ports:
            - 8099:8080
            - 8443:8443
            - 9990:9990
        volumes:
            - ./../target/keycloak-dev-docker:/data
        links:
            - lab-mysql
</code></pre>

<hr />

<p>Vérifier que les images ont bien été déployées.</p>

<pre><code>docker ps -a
</code></pre>

<hr />

<pre><code>CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                             PORTS                                                                    NAMES
de2face102da        jboss/keycloak       &quot;/opt/jboss/tools/do…&quot;   22 seconds ago      Up 16 seconds                      0.0.0.0:8443-&gt;8443/tcp, 0.0.0.0:9990-&gt;9990/tcp, 0.0.0.0:8099-&gt;8080/tcp   keycloak-dev-docker
2909874a449a        postgres             &quot;docker-entrypoint.s…&quot;   33 seconds ago      Up 24 seconds                      0.0.0.0:5432-&gt;5432/tcp                                                   postgresql-dev-docker
1cef41fa3f93        mysql/mysql-server   &quot;/entrypoint.sh mysq…&quot;   33 seconds ago      Up 23 seconds (health: starting)   0.0.0.0:3306-&gt;3306/tcp, 33060/tcp                                        mysql-dev-docker
</code></pre>

<hr />

<p>Si nécessaire, récupérer l&rsquo;ip de l&rsquo;image mysql-dev-docker.</p>

<pre><code>docker inspect mysql-dev-docker
</code></pre>

<hr />

<pre><code>&quot;NetworkID&quot;: &quot;909b56f4c2caa1c594f8d691e0204cc236849fb25ddb2302bb75fcba516a8698&quot;,
&quot;EndpointID&quot;: &quot;21d1c92defc16198b971ecf87be244bcff13c3e8bb5750753c8d2c428a85685e&quot;,
&quot;Gateway&quot;: &quot;172.25.0.1&quot;,
&quot;IPAddress&quot;: &quot;172.25.0.3&quot;,
</code></pre>

<hr />

<p>Restaurer la base de données Mysql.</p>

<pre><code>cd keycloak-config
cat backup.sql | docker exec -i mysql-dev-docker /usr/bin/mysql -h '172.25.0.3' -u keycloak -ppassword keycloak
</code></pre>

<p>ou</p>

<pre><code>cd keycloak-config
cat backup.sql | docker exec -i mysql-dev-docker /usr/bin/mysql -u keycloak -ppassword keycloak
</code></pre>

<hr />

<p>Un warning indique qu&rsquo;il n&rsquo;est pas recommandé de renseigner le password dans une ligne de commande&hellip;</p>

<pre><code>mysql: [Warning] Using a password on the command line interface can be insecure.
</code></pre>

<hr />

<p>Si soucis de lancement de keycloak apres la restauration de la base de données.</p>

<pre><code>CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                          PORTS                               NAMES
c3246b20fde4        jboss/keycloak       &quot;/opt/jboss/tools/do…&quot;   3 minutes ago       Restarting (1) 11 seconds ago                                       keycloak-dev-docker
99c412204936        postgres             &quot;docker-entrypoint.s…&quot;   3 minutes ago       Up 3 minutes                    0.0.0.0:5432-&gt;5432/tcp              postgresql-dev-docker
ed42957b5ff5        mysql/mysql-server   &quot;/entrypoint.sh mysq…&quot;   3 minutes ago       Up 3 minutes (healthy)          0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   mysql-dev-docker
</code></pre>

<hr />

<p>Il faut arrêter/supprimer les images.</p>

<pre><code>docker stop keycloak-dev-docker
docker rm keycloak-dev-docker
docker stop postgresql-dev-docker
docker rm postgresql-dev-docker
docker stop mysql-dev-docker
docker rm mysql-dev-docker
docker system prune -a
</code></pre>

<hr />

<pre><code>Total reclaimed space: 1.339GB
</code></pre>

<hr />

<p>Rebuild et déployer les images.</p>

<pre><code>cd dev-docker
docker-compose -f docker-compose.yml up -d
</code></pre>

<hr />

<p>En relancant la commande docker ps -a nous constatons que tout est rentré dans l&rsquo;ordre.</p>

<pre><code>CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                             PORTS                                                                    NAMES
97b1d64bf536        jboss/keycloak       &quot;/opt/jboss/tools/do…&quot;   25 seconds ago      Up 18 seconds                      0.0.0.0:8443-&gt;8443/tcp, 0.0.0.0:9990-&gt;9990/tcp, 0.0.0.0:8099-&gt;8080/tcp   keycloak-dev-docker
3b9e6f4a82e3        postgres             &quot;docker-entrypoint.s…&quot;   38 seconds ago      Up 23 seconds                      0.0.0.0:5432-&gt;5432/tcp                                                   postgresql-dev-docker
2bd8051a1850        mysql/mysql-server   &quot;/entrypoint.sh mysq…&quot;   38 seconds ago      Up 24 seconds (health: starting)   0.0.0.0:3306-&gt;3306/tcp, 33060/tcp                                        mysql-dev-docker
</code></pre>

<hr />

<h3 id="les-profils-maven-et-springboot">Les profils maven et Springboot</h3>

<p>toDo</p>

<h3 id="les-tests">Les tests</h3>

<p>toDo</p>

<hr />

				</section>
			</article>
		</main>
	</div> 

	

<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div id="sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4 class="sidebar-heading">Table of Contents</h4>
			<ul>
				<li><strong><a href="#title">Keycloak</a></strong></li>
			</ul>
			<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#vidéos-de-m-mohamed-youssfi">Vidéos de M. Mohamed Youssfi</a></li>
<li><a href="#dépôts-gitlab">Dépôts Gitlab</a></li>
<li><a href="#projet-spécificités-techniques">Projet : spécificités techniques</a></li>
<li><a href="#projet-spécificités-fonctionnelles">Projet : spécificités fonctionnelles</a></li>
<li><a href="#serveur-d-authentification-100-portable-avec-docker">Serveur d&rsquo;authentification 100 % portable avec docker</a></li>
<li><a href="#déploiement-de-keycloak-dans-une-vm-gcp">Déploiement de Keycloak dans une VM GCP</a></li>
<li><a href="#l-ihm-de-keycloak">L&rsquo;IHM de Keycloak</a></li>
</ul></li>
<li><a href="#back-end-en-java-avec-springboot">Back-end en java avec Springboot</a>
<ul>
<li><a href="#déploiement-du-back-end-et-serveur-keycloak-100-sur-son-local">Déploiement du Back-end et serveur Keycloak 100% sur son local</a></li>
<li><a href="#les-profils-maven-et-springboot">Les profils maven et Springboot</a></li>
<li><a href="#les-tests">Les tests</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
		</div>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Pages in Categories</h4>
		<ul class="sidebar-category-list">
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/gitlab">
					<span class="doc-list-category">Gitlab</span>
				</a>
				<ul>
					<li><a href="/blog/articles/gitlab/">Gitlab</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/keycloak">
					<span class="doc-list-category">Keycloak</span>
				</a>
				<ul>
					<li>
						<span class="active">Keycloak</span>
						</li>
				
				</ul>
			</li>
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/spring-security">
					<span class="doc-list-category">Spring-Security</span>
				</a>
				<ul>
					<li><a href="/blog/articles/spring-security/">Spring Security</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="https://jeannory.github.io/blog/categories/springboot-tests">
					<span class="doc-list-category">Springboot-Tests</span>
				</a>
				<ul>
					<li><a href="/blog/articles/springboot-tests/">Springboot-tests</a>
					</li>
				
				</ul>
			</li>
		
		</ul>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Tags</h4>
		<div class="tag-box">
		
			<a class="tag-item" href="https://jeannory.github.io/blog/tags/articles">articles</a>
		
			<a class="tag-item" href="https://jeannory.github.io/blog/tags/author">author</a>
		
		</div>
	</div>
	</div>
</div>

</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		<p class="doc-footer-em"><a href="#" onclick="resetSidebarPos()">Back to TOP</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	
	
	<p>Powered by <strong><a href="https://github.com/progrhyme/hugo-theme-bootie-docs">Bootie Docs</a></strong> - theme for <a href="http://gohugo.io/">Hugo</a> by <a href="https://github.com/progrhyme/">progrhyme</a>.</p>
</footer>



<script src="https://jeannory.github.io/blog/js/jquery.min.js"></script>
<script src="https://jeannory.github.io/blog/js/bootstrap.min.js"></script>

<script src="https://jeannory.github.io/blog/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="https://jeannory.github.io/blog/js/ie10-viewport-bug-workaround.js"></script>
<script src="https://jeannory.github.io/blog/js/bootie-docs.js"></script>

</body>
</html>
